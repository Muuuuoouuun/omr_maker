[{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\actions\\analyzeKey.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseError' is defined but never used.","line":50,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\create\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3726,3729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3726,3729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\groups\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\groups\\page.tsx:15:13\n  13 |         if (stored) {\n  14 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 15 |             setGroups(JSON.parse(stored));\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  16 |         }\n  17 |     }, []);\n  18 |","line":15,"column":13,"nodeType":null,"endLine":15,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\page.tsx:24:7\n  22 |     if (stored) {\n  23 |       // eslint-disable-next-line react-hooks/set-state-in-effect\n> 24 |       setGroups(JSON.parse(stored));\n     |       ^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |     }\n  26 |   }, []);\n  27 |","line":24,"column":7,"nodeType":null,"endLine":24,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\solve\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isAuthorized' is assigned a value but never used.","line":21,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedGroupId' is assigned a value but never used.","line":22,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'availableGroups' is assigned a value but never used.","line":24,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":27}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1108,1111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1108,1111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checkGroupAccess' is assigned a value but never used.","line":192,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":192,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport OMRPreview from \"@/components/OMRPreview\";\r\nimport dynamic from \"next/dynamic\";\r\n\r\nconst PDFViewer = dynamic(() => import(\"@/components/PDFViewer\"), { ssr: false });\r\nimport { Question } from \"@/types/omr\";\r\n\r\nexport default function SolvePage() {\r\n    const params = useParams();\r\n    const id = params?.id as string;\r\n\r\n    const [examData, setExamData] = useState<{ title: string; questions: Question[]; accessConfig?: { type: string; groupIds: string[] } } | null>(null);\r\n    const [studentAnswers, setStudentAnswers] = useState<Record<number, number>>({});\r\n    const [drawings, setDrawings] = useState<Record<number, string[]>>({});\r\n    const [pdfFile, setPdfFile] = useState<File | null>(null);\r\n\r\n    const [isAuthorized, setIsAuthorized] = useState(false);\r\n    const [selectedGroupId, setSelectedGroupId] = useState(\"\");\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    const [availableGroups, setAvailableGroups] = useState<any[]>([]);\r\n    const [user, setUser] = useState<{ name: string; isGuest?: boolean; guestId?: string } | null>(null);\r\n\r\n    // Navigation State\r\n    const [currentQuestionId, setCurrentQuestionId] = useState<number | null>(null);\r\n    const [pdfCurrentPage, setPdfCurrentPage] = useState<number | undefined>(undefined);\r\n\r\n    // Teacher Mode State\r\n    const [isTeacherMode, setIsTeacherMode] = useState(false);\r\n    const [activeTab, setActiveTab] = useState<'problem' | 'answer'>('problem');\r\n    const [answerFile, setAnswerFile] = useState<File | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Load User Session\r\n        const sessionStr = sessionStorage.getItem(\"omr_student_session\");\r\n        if (sessionStr) {\r\n            setUser(JSON.parse(sessionStr));\r\n        }\r\n\r\n        const loadExam = async () => {\r\n            if (id) {\r\n                const data = localStorage.getItem(`omr_exam_${id}`);\r\n                if (data) {\r\n                    try {\r\n                        const parsed = JSON.parse(data);\r\n                        setExamData(parsed);\r\n\r\n                        // Convert base64 pdfData (Problem PDF) back to File\r\n                        if (parsed.pdfData) {\r\n                            try {\r\n                                const fetchRes = await fetch(parsed.pdfData);\r\n                                const blob = await fetchRes.blob();\r\n                                const file = new File([blob], \"problem.pdf\", { type: \"application/pdf\" });\r\n                                setPdfFile(file);\r\n                            } catch (err) {\r\n                                console.error(\"Failed to load problem PDF\", err);\r\n                            }\r\n                        }\r\n\r\n                        // Convert base64 answerKeyPdf back to File\r\n                        if (parsed.answerKeyPdf) {\r\n                            try {\r\n                                const fetchRes = await fetch(parsed.answerKeyPdf);\r\n                                const blob = await fetchRes.blob();\r\n                                const file = new File([blob], \"answer_key.pdf\", { type: \"application/pdf\" });\r\n                                setAnswerFile(file);\r\n                            } catch (err) {\r\n                                console.error(\"Failed to load answer key PDF\", err);\r\n                            }\r\n                        }\r\n\r\n                        // Check Access Control\r\n                        if (parsed.accessConfig?.type === 'group') {\r\n                            setIsAuthorized(false);\r\n                            // Load groups for selection (Simulation of \"User's Groups\")\r\n                            const groups = localStorage.getItem('omr_groups');\r\n                            if (groups) {\r\n                                setAvailableGroups(JSON.parse(groups));\r\n                            }\r\n                        } else {\r\n                            setIsAuthorized(true);\r\n                        }\r\n                    } catch (err) {\r\n                        alert(\"ì‹œí—˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨\");\r\n                        console.error(err);\r\n                    }\r\n                } else {\r\n                    alert(\"ìœ íš¨í•˜ì§€ ì•Šì€ ì‹œí—˜ IDì´ê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r\n                }\r\n            }\r\n        };\r\n\r\n        loadExam();\r\n    }, [id]);\r\n\r\n    const handleAnswerClick = (qId: number, optionIndex: number) => {\r\n        setStudentAnswers(prev => ({\r\n            ...prev,\r\n            [qId]: optionIndex\r\n        }));\r\n        // Auto-select question when answering\r\n        handleQuestionClick(qId);\r\n    };\r\n\r\n    const handleQuestionClick = (qId: number) => {\r\n        setCurrentQuestionId(qId);\r\n        if (examData) {\r\n            const q = examData.questions.find(q => q.id === qId);\r\n            if (q?.pdfLocation?.page) {\r\n                setPdfCurrentPage(q.pdfLocation.page);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleDrawingsChange = (page: number, newPaths: string[]) => {\r\n        setDrawings(prev => ({\r\n            ...prev,\r\n            [page]: newPaths\r\n        }));\r\n    };\r\n\r\n\r\n\r\n    // ... (intermediate code) ...\r\n\r\n    const handleSubmit = () => {\r\n        if (!confirm(\"ì •ë§ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (í˜„ì¬ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤)\")) return;\r\n\r\n        if (!examData) return;\r\n\r\n        // Ensure User\r\n        let submitter = user;\r\n        if (!submitter) {\r\n            // Guest Flow for Public Exams\r\n            if (examData.accessConfig?.type === 'public') {\r\n                const name = prompt(\"ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ê²ŒìŠ¤íŠ¸ ì œì¶œ):\");\r\n                if (!name) return;\r\n                const guestId = Math.random().toString(36).substring(2, 15);\r\n                submitter = { name, isGuest: true, guestId };\r\n                // Save session for continuity\r\n                sessionStorage.setItem(\"omr_student_session\", JSON.stringify({ ...submitter, groupName: 'Guest' }));\r\n                localStorage.setItem(\"omr_guest_id\", guestId);\r\n            } else {\r\n                alert(\"ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì‹œí—˜ì…ë‹ˆë‹¤.\");\r\n                window.location.href = \"/\";\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Calculate Score\r\n        let correctCount = 0;\r\n        let totalCount = 0;\r\n\r\n        examData.questions.forEach(q => {\r\n            if (q.answer) {\r\n                totalCount++;\r\n                if (studentAnswers[q.id] === q.answer) {\r\n                    correctCount++;\r\n                }\r\n            }\r\n        });\r\n\r\n        const attemptId = Date.now().toString();\r\n        const attemptData = {\r\n            id: attemptId,\r\n            examId: id,\r\n            examTitle: examData.title,\r\n            studentName: submitter.name,\r\n            guestId: submitter.guestId, // Track Guest ID\r\n            startedAt: new Date().toISOString(),\r\n            finishedAt: new Date().toISOString(),\r\n            score: correctCount,\r\n            totalScore: totalCount,\r\n            answers: studentAnswers,\r\n            drawings: drawings,\r\n            status: 'completed'\r\n        };\r\n\r\n        // Save to Local Storage (List of attempts)\r\n        const history = JSON.parse(localStorage.getItem('omr_attempts') || '[]');\r\n        history.push(attemptData);\r\n        localStorage.setItem('omr_attempts', JSON.stringify(history));\r\n\r\n        alert(`ì œì¶œ ì™„ë£Œ! ì ìˆ˜: ${correctCount}/${totalCount}`);\r\n        window.location.href = `/student/review/${attemptId}`;\r\n    };\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const checkGroupAccess = () => {\r\n        if (!examData?.accessConfig?.groupIds) return;\r\n\r\n        if (examData.accessConfig.groupIds.includes(selectedGroupId)) {\r\n            setIsAuthorized(true);\r\n        } else {\r\n            alert(\"ì´ ì‹œí—˜ì— ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê·¸ë£¹ì…ë‹ˆë‹¤.\");\r\n        }\r\n    };\r\n\r\n    const toggleTeacherMode = (checked: boolean) => {\r\n        if (checked) {\r\n            const password = prompt(\"ì„ ìƒë‹˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ê¸°ë³¸: admin123)\");\r\n            if (password === \"admin123\") {\r\n                setIsTeacherMode(true);\r\n            } else {\r\n                alert(\"ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.\");\r\n                setIsTeacherMode(false);\r\n            }\r\n        } else {\r\n            setIsTeacherMode(false);\r\n        }\r\n    };\r\n\r\n    if (!examData) {\r\n        return (\r\n            <div style={{ padding: '2rem', textAlign: 'center' }}>\r\n                <h2>ì‹œí—˜ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>\r\n                <Link href=\"/\" className=\"btn btn-secondary\">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</Link>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"layout-main\" style={{ background: '#f1f5f9', height: '100vh', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\r\n            <header className=\"header\" style={{ flexShrink: 0, justifyContent: 'space-between' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                    <div className=\"logo\" style={{ fontSize: '1.2rem' }}>Answer Mode</div>\r\n                    <span style={{ fontSize: '0.9rem', color: '#666' }}>ID: {id}</span>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.85rem', cursor: 'pointer', background: 'rgba(0,0,0,0.05)', padding: '0.3rem 0.6rem', borderRadius: '4px' }}>\r\n                        <input type=\"checkbox\" checked={isTeacherMode} onChange={(e) => toggleTeacherMode(e.target.checked)} />\r\n                        ì„ ìƒë‹˜ ëª¨ë“œ\r\n                    </label>\r\n\r\n                    {/* Teacher Mode Specific Controls */}\r\n                    {isTeacherMode ? (\r\n                        <div style={{ display: 'flex', background: '#e2e8f0', borderRadius: '4px', padding: '2px' }}>\r\n                            <button\r\n                                onClick={() => setActiveTab('problem')}\r\n                                style={{ padding: '0.3rem 0.8rem', fontSize: '0.85rem', borderRadius: '4px', border: 'none', background: activeTab === 'problem' ? 'white' : 'transparent', fontWeight: activeTab === 'problem' ? 'bold' : 'normal', cursor: 'pointer' }}\r\n                            >\r\n                                ë¬¸ì œì§€\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setActiveTab('answer')}\r\n                                style={{ padding: '0.3rem 0.8rem', fontSize: '0.85rem', borderRadius: '4px', border: 'none', background: activeTab === 'answer' ? 'white' : 'transparent', fontWeight: activeTab === 'answer' ? 'bold' : 'normal', cursor: 'pointer' }}\r\n                            >\r\n                                ì •ë‹µ/í•´ì„¤\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <label className=\"btn btn-secondary\" style={{ cursor: 'pointer', fontSize: '0.85rem' }}>\r\n                            ğŸ“„ ë¬¸ì œì§€(PDF) ì—´ê¸°\r\n                            <input id=\"pdf-upload-input\" type=\"file\" accept=\".pdf\" onChange={(e) => e.target.files && setPdfFile(e.target.files[0])} style={{ display: 'none' }} />\r\n                        </label>\r\n                    )}\r\n\r\n                    <button className=\"btn btn-primary\" onClick={handleSubmit}>\r\n                        âœ… ì œì¶œí•˜ê¸°\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div style={{ display: 'flex', flex: 1, overflow: 'hidden' }}>\r\n                {/* PDF ViewerArea (Left) */}\r\n                <div style={{ flex: 1, borderRight: '1px solid #ddd', background: '#222', position: 'relative', display: 'flex', flexDirection: 'column' }}>\r\n                    {/* Tab Context specific toolbar */}\r\n                    {isTeacherMode && activeTab === 'answer' && !answerFile && (\r\n                        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10, pointerEvents: 'none' }}>\r\n                            <label className=\"btn btn-primary\" style={{ pointerEvents: 'auto', cursor: 'pointer', boxShadow: '0 4px 10px rgba(0,0,0,0.3)' }}>\r\n                                ğŸ“ í•´ì„¤/ì •ë‹µ PDF ì—…ë¡œë“œ\r\n                                <input type=\"file\" accept=\".pdf\" onChange={(e) => e.target.files && setAnswerFile(e.target.files[0])} style={{ display: 'none' }} />\r\n                            </label>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isTeacherMode && activeTab === 'problem' && !pdfFile && (\r\n                        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10, pointerEvents: 'none' }}>\r\n                            <label className=\"btn btn-secondary\" style={{ pointerEvents: 'auto', cursor: 'pointer', boxShadow: '0 4px 10px rgba(0,0,0,0.3)' }}>\r\n                                ğŸ“„ ë¬¸ì œì§€ PDF ì—…ë¡œë“œ\r\n                                <input type=\"file\" accept=\".pdf\" onChange={(e) => e.target.files && setPdfFile(e.target.files[0])} style={{ display: 'none' }} />\r\n                            </label>\r\n                        </div>\r\n                    )}\r\n\r\n                    <PDFViewer\r\n                        file={activeTab === 'problem' ? pdfFile : answerFile}\r\n                        onLoadSuccess={() => { }}\r\n                        onFileDrop={activeTab === 'problem' ? setPdfFile : setAnswerFile}\r\n                        enableDrawing={true}\r\n                        drawings={drawings}\r\n                        onDrawingsChange={handleDrawingsChange}\r\n                        forcePage={activeTab === 'problem' ? pdfCurrentPage : undefined}\r\n                        markers={(activeTab === 'problem' && examData.questions)\r\n                            ? examData.questions\r\n                                .filter((q: Question) => q.pdfLocation)\r\n                                .map((q: Question) => ({\r\n                                    page: q.pdfLocation!.page,\r\n                                    x: q.pdfLocation!.x,\r\n                                    y: q.pdfLocation!.y,\r\n                                    label: q.number,\r\n                                    color: currentQuestionId === q.id ? '#6366f1' : '#ef4444',\r\n                                    onClick: () => handleQuestionClick(q.id)\r\n                                }))\r\n                            : []}\r\n                    />\r\n                </div>\r\n\r\n                {/* OMR Sheet (Right) */}\r\n                <div style={{ flex: 1, display: 'flex', justifyContent: 'center', overflowY: 'auto', padding: '2rem', background: '#e2e8f0' }}>\r\n                    <div style={{ transform: 'scale(0.9)', transformOrigin: 'top center', height: 'fit-content' }}>\r\n                        <OMRPreview\r\n                            title={examData.title}\r\n                            questions={examData.questions}\r\n                            mode=\"solve\"\r\n                            userAnswers={studentAnswers}\r\n                            selectedQuestionId={currentQuestionId}\r\n                            onAnswerClick={handleAnswerClick}\r\n                            onQuestionClick={handleQuestionClick}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\dashboard\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\dashboard\\page.tsx:31:9\n  29 |         const currentUser = JSON.parse(session);\n  30 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 31 |         setUser(currentUser);\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  32 |\n  33 |         // 2. Load Data\n  34 |         const allExams: Exam[] = [];","line":31,"column":9,"nodeType":null,"endLine":31,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":41,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\history\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\history\\page.tsx:18:17\n  16 |                 parsed.sort((a: Attempt, b: Attempt) => new Date(b.finishedAt).getTime() - new Date(a.finishedAt).getTime());\n  17 |                 // eslint-disable-next-line react-hooks/set-state-in-effect\n> 18 |                 setAttempts(parsed);\n     |                 ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  19 |             } catch (e) {\n  20 |                 console.error(\"Failed to load history\", e);\n  21 |             }","line":18,"column":17,"nodeType":null,"endLine":18,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\review\\[attemptId]\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\review\\[attemptId]\\page.tsx:26:21\n  24 |                 if (found) {\n  25 |                     // eslint-disable-next-line react-hooks/set-state-in-effect\n> 26 |                     setAttempt(found);\n     |                     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  27 |                     // Load Exam Data associated with this attempt\n  28 |                     // Note: In real app, we fetch by examId. Here we rely on the exam saving key convention.\n  29 |                     const examDataStr = localStorage.getItem(`omr_exam_${found.examId}`);","line":26,"column":21,"nodeType":null,"endLine":26,"endColumn":31,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\dashboard\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":37,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":46,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\dashboard\\page.tsx:52:9\n  50 |         loadedExams.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  51 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 52 |         setExams(loadedExams);\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  53 |         setAttempts(loadedAttempts);\n  54 |\n  55 |         // Calculate Stats","line":52,"column":9,"nodeType":null,"endLine":52,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\exam\\[id]\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\exam\\[id]\\page.tsx:29:13\n  27 |         if (examData) {\n  28 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 29 |             setExam(JSON.parse(examData));\n     |             ^^^^^^^ Avoid calling setState() directly within an effect\n  30 |         }\n  31 |\n  32 |         // Load Attempts for this exam","line":29,"column":13,"nodeType":null,"endLine":29,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\AnswerImportModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'file'. Either include it or remove the dependency array.","line":26,"column":8,"nodeType":"ArrayExpression","endLine":26,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [file, useAI]","fix":{"range":[1039,1046],"text":"[file, useAI]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1904,1907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1904,1907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\DistributeModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[328,331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[328,331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\OMRPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\PDFViewer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":280,"column":45,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":280,"endColumn":80}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\PDFViewer.tsx:53:13\n  51 |         if (typeof forcePage === 'number' && forcePage >= 1 && forcePage <= numPages) {\n  52 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 53 |             setPageNumber(forcePage);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  54 |         }\n  55 |     }, [forcePage, numPages]);\n  56 |","line":53,"column":13,"nodeType":null,"endLine":53,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { Document, Page, pdfjs } from 'react-pdf';\r\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\r\nimport 'react-pdf/dist/Page/TextLayer.css';\r\n\r\n// Worker setup for Next.js\r\npdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\r\n\r\ninterface PDFViewerProps {\r\n    file: File | null;\r\n    onLoadSuccess: (numPages: number) => void;\r\n    onPageClick?: (page: number, x: number, y: number) => void;\r\n    onFileDrop?: (file: File) => void;\r\n    // Drawing Props\r\n    enableDrawing?: boolean;\r\n    drawings?: Record<number, string[]>; // per page, array of path strings\r\n    onDrawingsChange?: (page: number, newPaths: string[]) => void;\r\n    // Markers Props\r\n    markers?: { page: number; x: number; y: number; label: string | number; color?: string; onClick?: () => void }[];\r\n}\r\n\r\nexport default function PDFViewer({\r\n    file,\r\n    onLoadSuccess,\r\n    onPageClick,\r\n    onFileDrop,\r\n    enableDrawing = false,\r\n    drawings = {},\r\n    onDrawingsChange,\r\n    markers = [],\r\n    forcePage\r\n}: PDFViewerProps & { forcePage?: number }) {\r\n    const [numPages, setNumPages] = useState<number>(0);\r\n    const [pageNumber, setPageNumber] = useState<number>(1);\r\n    const [scale, setScale] = useState<number>(1.0);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n\r\n    // Drawing State\r\n    const [isDrawing, setIsDrawing] = useState(false);\r\n    const [currentPath, setCurrentPath] = useState<{ x: number, y: number }[]>([]);\r\n    const [drawingMode, setDrawingMode] = useState<'pen' | 'eraser'>('pen');\r\n    const [penColor, setPenColor] = useState('#ef4444'); // Default Red\r\n\r\n    // Canvas Ref\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (typeof forcePage === 'number' && forcePage >= 1 && forcePage <= numPages) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            setPageNumber(forcePage);\r\n        }\r\n    }, [forcePage, numPages]);\r\n\r\n    function onDocumentLoadSuccess({ numPages }: { numPages: number }) {\r\n        setNumPages(numPages);\r\n        onLoadSuccess(numPages);\r\n    }\r\n\r\n    // --- Drawing Logic ---\r\n\r\n    // Render existing paths when page or drawings change\r\n    useEffect(() => {\r\n        if (!enableDrawing || !canvasRef.current || !containerRef.current) return;\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        // Resize canvas to match container (vital for scaling)\r\n        const rect = containerRef.current.getBoundingClientRect();\r\n        canvas.width = rect.width;\r\n        canvas.height = rect.height;\r\n\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n        // Draw saved paths\r\n        const paths = drawings[pageNumber] || [];\r\n        paths.forEach(pathStr => {\r\n            const pathData = JSON.parse(pathStr);\r\n            if (pathData.points && pathData.points.length > 0) {\r\n                ctx.beginPath();\r\n                ctx.strokeStyle = pathData.color;\r\n                ctx.lineWidth = 2;\r\n                ctx.moveTo(pathData.points[0].x * canvas.width, pathData.points[0].y * canvas.height);\r\n                for (let i = 1; i < pathData.points.length; i++) {\r\n                    ctx.lineTo(pathData.points[i].x * canvas.width, pathData.points[i].y * canvas.height);\r\n                }\r\n                ctx.stroke();\r\n            }\r\n        });\r\n\r\n    }, [pageNumber, drawings, enableDrawing, scale, file]); // Re-render on these changes\r\n\r\n    const startDrawing = (e: React.MouseEvent | React.TouchEvent) => {\r\n        if (!enableDrawing || drawingMode === 'eraser') return;\r\n        setIsDrawing(true);\r\n        const pos = getPos(e);\r\n        setCurrentPath([pos]);\r\n    };\r\n\r\n    const draw = (e: React.MouseEvent | React.TouchEvent) => {\r\n        if (!isDrawing || !enableDrawing || !canvasRef.current) return;\r\n        const pos = getPos(e);\r\n        setCurrentPath(prev => [...prev, pos]);\r\n\r\n        // Real-time visual feedback\r\n        const ctx = canvasRef.current.getContext('2d');\r\n        if (ctx) {\r\n            const rect = canvasRef.current.getBoundingClientRect();\r\n            ctx.lineTo(pos.x * rect.width, pos.y * rect.height);\r\n            ctx.stroke();\r\n            // Note: This is a hacky visual update, real render happens on useEffect usually.\r\n            // Better: draw single segment.\r\n            ctx.beginPath();\r\n            const last = currentPath[currentPath.length - 1];\r\n            if (last) ctx.moveTo(last.x * rect.width, last.y * rect.height);\r\n            ctx.lineTo(pos.x * rect.width, pos.y * rect.height);\r\n            ctx.strokeStyle = penColor;\r\n            ctx.lineWidth = 2;\r\n            ctx.stroke();\r\n        }\r\n    };\r\n\r\n    const stopDrawing = () => {\r\n        if (!isDrawing) return;\r\n        setIsDrawing(false);\r\n\r\n        // Save Path\r\n        if (currentPath.length > 1 && onDrawingsChange) {\r\n            const newPath = {\r\n                color: penColor,\r\n                points: currentPath\r\n            };\r\n            const currentPaths = drawings[pageNumber] || [];\r\n            onDrawingsChange(pageNumber, [...currentPaths, JSON.stringify(newPath)]);\r\n        }\r\n        setCurrentPath([]);\r\n    };\r\n\r\n    const getPos = (e: React.MouseEvent | React.TouchEvent) => {\r\n        if (!canvasRef.current) return { x: 0, y: 0 };\r\n        const rect = canvasRef.current.getBoundingClientRect();\r\n        let clientX, clientY;\r\n        if ('touches' in e) {\r\n            clientX = e.touches[0].clientX;\r\n            clientY = e.touches[0].clientY;\r\n        } else {\r\n            clientX = (e as React.MouseEvent).clientX;\r\n            clientY = (e as React.MouseEvent).clientY;\r\n        }\r\n        return {\r\n            x: (clientX - rect.left) / rect.width,\r\n            y: (clientY - rect.top) / rect.height\r\n        };\r\n    };\r\n\r\n    const clearPage = () => {\r\n        if (confirm(\"ì´ í˜ì´ì§€ì˜ í•„ê¸°ë¥¼ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?\")) {\r\n            if (onDrawingsChange) {\r\n                onDrawingsChange(pageNumber, []);\r\n            }\r\n        }\r\n    };\r\n\r\n    // --- End Drawing Logic ---\r\n\r\n\r\n    function handlePageClick(event: React.MouseEvent<HTMLDivElement>) {\r\n        // ... (Existing click logic, maybe disable if drawing?)\r\n        if (enableDrawing && drawingMode === 'pen') return; // Don't trigger link click while drawing\r\n        if (!onPageClick) return;\r\n\r\n        const rect = event.currentTarget.getBoundingClientRect();\r\n        const x = event.clientX - rect.left;\r\n        const y = event.clientY - rect.top;\r\n        const normalizedX = x / rect.width;\r\n        const normalizedY = y / rect.height;\r\n\r\n        onPageClick(pageNumber, normalizedX, normalizedY);\r\n    }\r\n\r\n    // Drag & Drop Handlers (Existing...)\r\n    const handleDragOver = (e: React.DragEvent) => { e.preventDefault(); setIsDragging(true); };\r\n    const handleDragLeave = (e: React.DragEvent) => { e.preventDefault(); setIsDragging(false); };\r\n    const handleDrop = (e: React.DragEvent) => {\r\n        e.preventDefault(); setIsDragging(false);\r\n        if (onFileDrop && e.dataTransfer.files[0] && e.dataTransfer.files[0].type === 'application/pdf') {\r\n            onFileDrop(e.dataTransfer.files[0]);\r\n        } else { alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className=\"pdf-viewer-container\"\r\n            onDragOver={handleDragOver} onDragLeave={handleDragLeave} onDrop={handleDrop}\r\n            style={{\r\n                height: '100%', display: 'flex', flexDirection: 'column',\r\n                background: '#525659', borderRight: '1px solid #333', position: 'relative', overflow: 'hidden'\r\n            }}\r\n        >\r\n            {/* ... Drag Overlay ... */}\r\n            {isDragging && (\r\n                <div style={{ position: 'absolute', inset: 0, zIndex: 50, background: 'rgba(99, 102, 241, 0.2)', border: '3px dashed #6366f1', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold', fontSize: '1.5rem', backdropFilter: 'blur(4px)' }}>PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</div>\r\n            )}\r\n\r\n            {/* PDF Toolbar */}\r\n            <div style={{ padding: '0.5rem 1rem', background: '#323639', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontSize: '0.9rem', borderBottom: '1px solid #000' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                    <span style={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', maxWidth: '200px' }}>{file ? file.name : 'PDF ì—†ìŒ'}</span>\r\n                </div>\r\n\r\n                {file && (\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                        {/* Drawing Tools */}\r\n                        {enableDrawing && (\r\n                            <div style={{ display: 'flex', gap: '5px', marginRight: '1rem', paddingRight: '1rem', borderRight: '1px solid #666' }}>\r\n                                <button onClick={() => setDrawingMode(drawingMode === 'pen' ? 'eraser' : 'pen')} style={{ background: drawingMode === 'pen' ? '#6366f1' : 'transparent', border: '1px solid #666', borderRadius: '4px', padding: '2px 6px', color: 'white' }}>\r\n                                    {drawingMode === 'pen' ? 'âœï¸ ê·¸ë¦¬ê¸°' : 'ğŸ‘† í´ë¦­ëª¨ë“œ'}\r\n                                </button>\r\n                                {drawingMode === 'pen' && (\r\n                                    <>\r\n                                        <input type=\"color\" value={penColor} onChange={(e) => setPenColor(e.target.value)} style={{ width: '24px', height: '24px', padding: 0, border: 'none', background: 'none' }} />\r\n                                        <button onClick={clearPage} style={{ fontSize: '0.8rem', padding: '2px 6px', background: '#ef4444', border: 'none', borderRadius: '4px', color: 'white' }}>ì‚­ì œ</button>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        <button onClick={() => setPageNumber(p => Math.max(1, p - 1))} disabled={pageNumber <= 1} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer' }}>â—€</button>\r\n                        <span>{pageNumber} / {numPages}</span>\r\n                        <button onClick={() => setPageNumber(p => Math.min(numPages, p + 1))} disabled={pageNumber >= numPages} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer' }}>â–¶</button>\r\n                        <div style={{ width: '1px', height: '15px', background: '#666', margin: '0 0.5rem' }}></div>\r\n                        <button onClick={() => setScale(s => Math.max(0.5, s - 0.1))} style={{ color: 'white', cursor: 'pointer' }}>-</button>\r\n                        <span>{Math.round(scale * 100)}%</span>\r\n                        <button onClick={() => setScale(s => Math.min(2.5, s + 0.1))} style={{ color: 'white', cursor: 'pointer' }}>+</button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* PDF Content */}\r\n            <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', alignItems: 'center', background: '#525659', position: 'relative' }}>\r\n                <div style={{ flex: 1, display: 'flex', justifyContent: 'center', padding: '2rem', width: '100%' }}>\r\n                    {file ? (\r\n                        <Document file={file} onLoadSuccess={onDocumentLoadSuccess} loading={<div style={{ color: 'white' }}>ë¬¸ì„œ ë¡œë”© ì¤‘...</div>}>\r\n                            <div\r\n                                ref={containerRef}\r\n                                onClick={handlePageClick}\r\n                                style={{ position: 'relative', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)' }}\r\n                            >\r\n                                <Page pageNumber={pageNumber} scale={scale} renderTextLayer={true} renderAnnotationLayer={true} />{/* Canvas Overlay */}\r\n                                {enableDrawing && (\r\n                                    <canvas\r\n                                        ref={canvasRef}\r\n                                        onMouseDown={startDrawing}\r\n                                        onMouseMove={draw}\r\n                                        onMouseUp={stopDrawing}\r\n                                        onMouseLeave={stopDrawing}\r\n                                        onTouchStart={startDrawing}\r\n                                        onTouchMove={draw}\r\n                                        onTouchEnd={stopDrawing}\r\n                                        style={{\r\n                                            position: 'absolute',\r\n                                            top: 0, left: 0,\r\n                                            width: '100%', height: '100%',\r\n                                            zIndex: 10,\r\n                                            cursor: drawingMode === 'pen' ? 'crosshair' : 'default',\r\n                                            pointerEvents: drawingMode === 'pen' ? 'auto' : 'none' // Allow click through if not drawing\r\n                                        }}\r\n                                    />\r\n                                )}\r\n\r\n                                {/* Markers Overlay */}\r\n                                {markers.filter(m => m.page === pageNumber).map((marker, i) => (\r\n                                    <div\r\n                                        key={i}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            marker.onClick && marker.onClick();\r\n                                        }}\r\n                                        style={{\r\n                                            position: 'absolute',\r\n                                            left: `${marker.x * 100}%`,\r\n                                            top: `${marker.y * 100}%`,\r\n                                            transform: 'translate(-50%, -50%)',\r\n                                            zIndex: 20,\r\n                                            cursor: 'pointer',\r\n                                            width: '24px', height: '24px',\r\n                                            background: marker.color || '#ef4444',\r\n                                            color: 'white',\r\n                                            borderRadius: '50%',\r\n                                            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                            fontWeight: 'bold', fontSize: '0.75rem',\r\n                                            boxShadow: '0 2px 4px rgba(0,0,0,0.3)',\r\n                                            border: '2px solid white'\r\n                                        }}\r\n                                        title={`Question ${marker.label}`}\r\n                                    >\r\n                                        {marker.label}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </Document>\r\n                    ) : (\r\n                        <div onClick={() => document.getElementById('pdf-upload-input')?.click()} style={{ color: '#aaa', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', width: '100%', cursor: 'pointer', border: '2px dashed #666', margin: '1rem', borderRadius: '1rem' }}>\r\n                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>ğŸ“„</div>\r\n                            <p style={{ fontWeight: 600 }}>PDF ì—…ë¡œë“œ</p>\r\n                            <p style={{ fontSize: '0.8rem', opacity: 0.7 }}>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Bottom Pagination Toolbar (Only visible if file exists) */}\r\n                {file && (\r\n                    <div style={{\r\n                        width: '100%',\r\n                        padding: '0.5rem',\r\n                        background: '#323639',\r\n                        color: 'white',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        gap: '1rem',\r\n                        borderTop: '1px solid #000',\r\n                        marginTop: 'auto'\r\n                    }}>\r\n                        <button onClick={() => setPageNumber(p => Math.max(1, p - 1))} disabled={pageNumber <= 1} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer', background: 'rgba(255,255,255,0.1)', borderRadius: '4px', border: 'none' }}>â—€ ì´ì „</button>\r\n                        <span>{pageNumber} / {numPages}</span>\r\n                        <button onClick={() => setPageNumber(p => Math.min(numPages, p + 1))} disabled={pageNumber >= numPages} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer', background: 'rgba(255,255,255,0.1)', borderRadius: '4px', border: 'none' }}>ë‹¤ìŒ â–¶</button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\AssignmentBlock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\ExamListBlock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\TrendChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\tabs\\ExamAnalyticsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\tabs\\OverviewTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\tabs\\StudentAnalyticsTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'exams' is defined but never used.","line":16,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport { Exam, Attempt } from \"@/types/omr\";\r\nimport {\r\n    LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip,\r\n    ResponsiveContainer, Legend\r\n} from 'recharts';\r\nimport { TrendingUp } from \"lucide-react\";\r\n\r\ninterface StudentAnalyticsTabProps {\r\n    exams: Exam[];\r\n    attempts: Attempt[];\r\n}\r\n\r\nexport default function StudentAnalyticsTab({ exams, attempts }: StudentAnalyticsTabProps) {\r\n    // Extract unique students\r\n    const students = useMemo(() => {\r\n        const studentMap = new Map<string, string>();\r\n        attempts.forEach(a => {\r\n            if (!studentMap.has(a.studentName)) {\r\n                studentMap.set(a.studentName, a.studentName);\r\n            }\r\n        });\r\n        return Array.from(studentMap.values()).sort();\r\n    }, [attempts]);\r\n\r\n    const [selectedStudent, setSelectedStudent] = useState<string>(students.length > 0 ? students[0] : \"\");\r\n    const [excludedExamIds, setExcludedExamIds] = useState<Set<string>>(new Set());\r\n\r\n    const toggleExamExclusion = (examId: string) => {\r\n        const newSet = new Set(excludedExamIds);\r\n        if (newSet.has(examId)) {\r\n            newSet.delete(examId);\r\n        } else {\r\n            newSet.add(examId);\r\n        }\r\n        setExcludedExamIds(newSet);\r\n    };\r\n\r\n    const studentAttempts = useMemo(() => {\r\n        if (!selectedStudent) return [];\r\n        return attempts\r\n            .filter(a => a.studentName === selectedStudent)\r\n            .sort((a, b) => new Date(a.finishedAt).getTime() - new Date(b.finishedAt).getTime());\r\n    }, [attempts, selectedStudent]);\r\n\r\n    // Data for Chart\r\n    const trendData = useMemo(() => {\r\n        return studentAttempts\r\n            .filter(a => !excludedExamIds.has(a.examId))\r\n            .map(attempt => {\r\n                // Find all attempts for this exam to calculate average\r\n                const allAttemptsForExam = attempts.filter(a => a.examId === attempt.examId);\r\n                const avgScore = allAttemptsForExam.length > 0\r\n                    ? allAttemptsForExam.reduce((sum, a) => sum + (a.score / a.totalScore) * 100, 0) / allAttemptsForExam.length\r\n                    : 0;\r\n\r\n                return {\r\n                    date: new Date(attempt.finishedAt).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }),\r\n                    examTitle: attempt.examTitle,\r\n                    examId: attempt.examId,\r\n                    studentScore: Math.round((attempt.score / attempt.totalScore) * 100),\r\n                    avgScore: Math.round(avgScore),\r\n                };\r\n            });\r\n    }, [studentAttempts, attempts, excludedExamIds]);\r\n\r\n    if (students.length === 0) {\r\n        return <div className=\"text-center p-8 text-muted\">ì•„ì§ ì‘ì‹œ ê¸°ë¡ì´ ìˆëŠ” í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>;\r\n    }\r\n\r\n    // fallback when a student is not active\r\n    if (!selectedStudent && students.length > 0) {\r\n        setSelectedStudent(students[0]);\r\n    }\r\n\r\n    return (\r\n        <div className=\"fade-in-up\" style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>\r\n            {/* Filter Section */}\r\n            <div className=\"card\" style={{ padding: '1.5rem', display: 'flex', alignItems: 'center', gap: '1rem', background: 'var(--surface)' }}>\r\n                <span style={{ fontWeight: 600, color: 'var(--text)' }}>ë¶„ì„í•  í•™ìƒ ì„ íƒ:</span>\r\n                <select\r\n                    value={selectedStudent}\r\n                    onChange={(e) => setSelectedStudent(e.target.value)}\r\n                    style={{\r\n                        padding: '0.75rem 1rem',\r\n                        borderRadius: 'var(--radius-md)',\r\n                        border: '1px solid var(--border)',\r\n                        background: 'var(--background)',\r\n                        color: 'var(--text)',\r\n                        flex: 1,\r\n                        maxWidth: '400px',\r\n                        outline: 'none',\r\n                        cursor: 'pointer'\r\n                    }}\r\n                >\r\n                    {students.map(name => (\r\n                        <option key={name} value={name}>{name}</option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'minmax(0, 5fr) minmax(0, 3fr)', gap: '1.5rem' }}>\r\n                {/* Left side: Chart */}\r\n                <div className=\"card\" style={{ padding: '1.5rem', display: 'flex', flexDirection: 'column' }}>\r\n                    <div style={{ marginBottom: '1.5rem' }}>\r\n                        <h3 style={{ fontSize: '1.25rem', fontWeight: 700, display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>\r\n                            <TrendingUp size={20} color=\"var(--primary)\" />\r\n                            {selectedStudent} í•™ìƒ ì„±ì·¨ë„ ì¶”ì´\r\n                        </h3>\r\n                        <p style={{ color: 'var(--muted)', fontSize: '0.9rem' }}>\r\n                            ì‘ì‹œí•œ ì‹œí—˜ë“¤ì˜ ì ìˆ˜ ì¶”ì´ ë° ì „ì²´ í•™ìƒì˜ ì‹œí—˜ í‰ê· ì„ ê°™ì´ ë¹„êµí•©ë‹ˆë‹¤.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, minHeight: '350px', width: '100%' }}>\r\n                        {trendData.length > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <LineChart data={trendData} margin={{ top: 20, right: 30, left: 0, bottom: 20 }}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"var(--border)\" />\r\n                                    <XAxis dataKey=\"examTitle\" tick={{ fill: 'var(--muted)', fontSize: 12 }} axisLine={false} tickLine={false} />\r\n                                    <YAxis domain={[0, 100]} tick={{ fill: 'var(--muted)' }} axisLine={false} tickLine={false} />\r\n                                    <RechartsTooltip\r\n                                        contentStyle={{ borderRadius: '8px', border: '1px solid var(--border)', boxShadow: '0 4px 12px rgba(0,0,0,0.05)', background: 'var(--background)' }}\r\n                                        labelStyle={{ fontWeight: 'bold', color: 'var(--text)', marginBottom: '8px' }}\r\n                                    />\r\n                                    <Legend wrapperStyle={{ paddingTop: '20px' }} />\r\n                                    <Line\r\n                                        name=\"ë‚´ ì ìˆ˜\"\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"studentScore\"\r\n                                        stroke=\"var(--primary)\"\r\n                                        strokeWidth={3}\r\n                                        dot={{ r: 5, strokeWidth: 2, fill: 'var(--background)' }}\r\n                                        activeDot={{ r: 7 }}\r\n                                        animationDuration={1500}\r\n                                    />\r\n                                    <Line\r\n                                        name=\"ì´ë²ˆ ì‹œí—˜ ì „ì²´ í‰ê· \"\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"avgScore\"\r\n                                        stroke=\"var(--warning)\"\r\n                                        strokeWidth={2}\r\n                                        strokeDasharray=\"5 5\"\r\n                                        dot={{ r: 4, strokeWidth: 0, fill: 'var(--muted)' }}\r\n                                        animationDuration={1500}\r\n                                    />\r\n                                </LineChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div style={{ height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--muted)' }}>\r\n                                í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (ëª¨ë“  ì‹œí—˜ ëª©ë¡ì´ ì œì™¸ë¨)\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right side: Exam List & Inclusion Toggles */}\r\n                <div className=\"card\" style={{ padding: '1.5rem', display: 'flex', flexDirection: 'column' }}>\r\n                    <h3 style={{ fontSize: '1.1rem', fontWeight: 700, marginBottom: '0.5rem' }}>ì‘ì‹œ ê¸°ë¡ ({studentAttempts.length})</h3>\r\n                    <p style={{ fontSize: '0.85rem', color: 'var(--muted)', marginBottom: '1.5rem' }}>ì°¨íŠ¸ì—ì„œ ì œì™¸í•  ì‹œí—˜ì˜ ì²´í¬ë¥¼ í•´ì œí•˜ì„¸ìš”.</p>\r\n\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', overflowY: 'auto', flex: 1, maxHeight: '350px' }}>\r\n                        {studentAttempts.map(attempt => {\r\n                            const isExcluded = excludedExamIds.has(attempt.examId);\r\n                            const scoreRate = Math.round((attempt.score / attempt.totalScore) * 100);\r\n\r\n                            return (\r\n                                <label\r\n                                    key={attempt.id}\r\n                                    style={{\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        gap: '0.75rem',\r\n                                        padding: '0.75rem',\r\n                                        borderRadius: 'var(--radius-md)',\r\n                                        background: isExcluded ? 'transparent' : 'var(--surface)',\r\n                                        border: `1px solid ${isExcluded ? 'var(--border)' : 'var(--primary)'}`,\r\n                                        opacity: isExcluded ? 0.6 : 1,\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.2s'\r\n                                    }}\r\n                                    className=\"card-hover\"\r\n                                >\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={!isExcluded}\r\n                                        onChange={() => toggleExamExclusion(attempt.examId)}\r\n                                        style={{ accentColor: 'var(--primary)', width: '16px', height: '16px', cursor: 'pointer' }}\r\n                                    />\r\n                                    <div style={{ flex: 1, overflow: 'hidden' }}>\r\n                                        <div style={{ fontWeight: 600, fontSize: '0.9rem', whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}>{attempt.examTitle}</div>\r\n                                        <div style={{ fontSize: '0.75rem', color: 'var(--muted)' }}>{new Date(attempt.finishedAt).toLocaleDateString()}</div>\r\n                                    </div>\r\n                                    <div style={{ fontWeight: 800, fontSize: '1.1rem', color: scoreRate >= 80 ? 'var(--success)' : (scoreRate < 50 ? 'var(--error)' : 'var(--text)') }}>\r\n                                        {scoreRate}ì \r\n                                    </div>\r\n                                </label>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\services\\answerParser.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4795,4798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4795,4798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5243,5246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5243,5246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5491,5494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5491,5494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5571,5574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5571,5574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5579,5582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5579,5582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Answer parsing utility using PDF text extraction and Gemini AI for OCR\r\nimport { analyzeAnswerImages } from '@/app/actions/analyzeKey';\r\n\r\nexport interface ParsedAnswer {\r\n    questionNum: number;\r\n    answer: number; // 1=A, 2=B...\r\n    confidence: number; // 0-1\r\n    rawText: string;\r\n}\r\n\r\nasync function getPdfJs() {\r\n    const pdfjsLib = await import('pdfjs-dist');\r\n    // Ensure worker is set up\r\n    if (typeof window !== 'undefined' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\r\n        pdfjsLib.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjsLib.version}/build/pdf.worker.min.mjs`;\r\n    }\r\n    return pdfjsLib;\r\n}\r\n\r\nexport async function parseAnswerKeyPdf(file: File): Promise<ParsedAnswer[]> {\r\n    const pdfjsLib = await getPdfJs();\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\r\n\r\n    let allText = '';\r\n\r\n    // Extract text from all pages\r\n    for (let i = 1; i <= pdf.numPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n\r\n        // Sort items by Y (descending) then X (ascending) to approximate reading order\r\n        // Note: PDF coordinates: (0,0) is bottom-left usually.\r\n        // item.transform[5] is Y, item.transform[4] is X\r\n        const items = textContent.items.map((item: any) => ({\r\n            str: item.str,\r\n            x: item.transform[4],\r\n            y: item.transform[5]\r\n        }));\r\n\r\n        // Simple sort: Top to bottom, left to right\r\n        items.sort((a, b) => {\r\n            if (Math.abs(a.y - b.y) > 5) { // Threshold for same line\r\n                return b.y - a.y; // Higher Y first\r\n            }\r\n            return a.x - b.x;\r\n        });\r\n\r\n        const pageText = items.map(item => item.str).join(' ');\r\n        allText += ` ${pageText}`;\r\n    }\r\n\r\n    return extractAnswersFromText(allText);\r\n}\r\n\r\nfunction extractAnswersFromText(text: string): ParsedAnswer[] {\r\n    const results: ParsedAnswer[] = [];\r\n    const mapAnswerToNum = (ans: string): number => {\r\n        ans = ans.toUpperCase().trim();\r\n        const map: Record<string, number> = { 'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'â‘ ': 1, 'â‘¡': 2, 'â‘¢': 3, 'â‘£': 4, 'â‘¤': 5 };\r\n        return map[ans] || 0;\r\n    };\r\n\r\n    // Strategy 1: \"1. A\", \"2) B\", \"3-C\" patterns\r\n    // Regex explanation:\r\n    // (\\d+) : Question number\r\n    // \\s*[\\.\\)\\-]?\\s* : Separator (dot, parenthesis, hyphen, or just space)\r\n    // ([A-Eâ‘ -â‘¤]) : Answer (A-E or circled numbers)\r\n    const regex1 = /(\\d+)\\s*[\\.\\)\\-]\\s*([A-Eâ‘ -â‘¤])/gi;\r\n\r\n    let match;\r\n    while ((match = regex1.exec(text)) !== null) {\r\n        const qNum = parseInt(match[1], 10);\r\n        const ansStr = match[2];\r\n        const ansNum = mapAnswerToNum(ansStr);\r\n\r\n        if (qNum > 0 && ansNum > 0) {\r\n            // Check if duplicate, keep the one with higher confidence (or just overwrite)\r\n            // Here we assume sequential parsing is mostly correct\r\n            results.push({\r\n                questionNum: qNum,\r\n                answer: ansNum,\r\n                confidence: 0.9,\r\n                rawText: match[0]\r\n            });\r\n        }\r\n    }\r\n\r\n    // Strategy 2: Table format \"1 A\", \"2 B\" (if Strategy 1 failed for many)\r\n    if (results.length < 5) {\r\n        const regex2 = /(\\d+)\\s+([A-E])/gi;\r\n        while ((match = regex2.exec(text)) !== null) {\r\n            const qNum = parseInt(match[1], 10);\r\n            const ansNum = mapAnswerToNum(match[2]);\r\n            // Avoid duplicates\r\n            if (!results.find(r => r.questionNum === qNum)) {\r\n                results.push({\r\n                    questionNum: qNum,\r\n                    answer: ansNum,\r\n                    confidence: 0.7, // Lower confidence for just space separation\r\n                    rawText: match[0]\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return results.sort((a, b) => a.questionNum - b.questionNum);\r\n}\r\n\r\nexport async function parseAnswerKeyWithGemini(file: File): Promise<ParsedAnswer[]> {\r\n    const pdfjsLib = await getPdfJs();\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\r\n\r\n    const maxPages = Math.min(pdf.numPages, 3); // Limit to 3 pages\r\n    const images: string[] = [];\r\n\r\n    for (let i = 1; i <= maxPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const viewport = page.getViewport({ scale: 2.0 }); // Higher scale for better OCR\r\n\r\n        const canvas = document.createElement('canvas');\r\n        const context = canvas.getContext('2d');\r\n        canvas.height = viewport.height;\r\n        canvas.width = viewport.width;\r\n\r\n        if (context) {\r\n            await page.render({ canvasContext: context, viewport } as any).promise;\r\n            // Use JPEG instead of PNG to save bandwidth and stay under limits\r\n            images.push(canvas.toDataURL('image/jpeg', 0.8));\r\n        }\r\n    }\r\n\r\n    try {\r\n        const aiResults = await analyzeAnswerImages(images);\r\n\r\n        if (!Array.isArray(aiResults)) {\r\n            throw new Error(\"AI response is not an array\");\r\n        }\r\n\r\n        // Convert to ParsedAnswer format\r\n        return aiResults.map((item: any) => ({\r\n            questionNum: parseInt(item.questionNum || item.id || item.number),\r\n            answer: parseInt(item.answer || item.val),\r\n            confidence: 0.95,\r\n            rawText: JSON.stringify(item)\r\n        })).filter((item: any) => !isNaN(item.questionNum) && !isNaN(item.answer))\r\n            .sort((a: any, b: any) => a.questionNum - b.questionNum);\r\n    } catch (e) {\r\n        console.error(\"AI Parsing failed:\", e);\r\n        throw e;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\types\\omr.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\utils\\storage.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1782,1785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1782,1785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const STORAGE_KEYS = {\r\n    EXAMS: \"omr_exams\", // Prefix for individual exams? No, current logic scans omr_exam_ prefix.\r\n    ATTEMPTS: \"omr_attempts\",\r\n    STUDENT_SESSION: \"omr_student_session\",\r\n    GUEST_ID: \"omr_guest_id\"\r\n};\r\n\r\nexport interface StudentSession {\r\n    name: string;\r\n    groupId?: string; // Optional for guest\r\n    groupName?: string;\r\n    isGuest: boolean;\r\n    guestId?: string; // specific UUID for guest\r\n}\r\n\r\n// Helper to generate UUID-like string\r\nexport function generateId(): string {\r\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\r\n}\r\n\r\nexport function getOrCreateGuestId(): string {\r\n    if (typeof window === 'undefined') return \"\";\r\n    let id = localStorage.getItem(STORAGE_KEYS.GUEST_ID);\r\n    if (!id) {\r\n        id = generateId();\r\n        localStorage.setItem(STORAGE_KEYS.GUEST_ID, id);\r\n    }\r\n    return id;\r\n}\r\n\r\nexport function saveSession(session: StudentSession) {\r\n    if (typeof window === 'undefined') return;\r\n    sessionStorage.setItem(STORAGE_KEYS.STUDENT_SESSION, JSON.stringify(session));\r\n}\r\n\r\nexport function getSession(): StudentSession | null {\r\n    if (typeof window === 'undefined') return null;\r\n    const str = sessionStorage.getItem(STORAGE_KEYS.STUDENT_SESSION);\r\n    return str ? JSON.parse(str) : null;\r\n}\r\n\r\nexport function clearSession() {\r\n    if (typeof window === 'undefined') return;\r\n    sessionStorage.removeItem(STORAGE_KEYS.STUDENT_SESSION);\r\n}\r\n\r\n// Data Merging Logic\r\nexport function mergeGuestAttempts(guestId: string, realStudentName: string) {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const attemptsStr = localStorage.getItem(STORAGE_KEYS.ATTEMPTS);\r\n    if (!attemptsStr) return;\r\n\r\n    try {\r\n        const allAttempts: any[] = JSON.parse(attemptsStr);\r\n        let updated = false;\r\n\r\n        const newAttempts = allAttempts.map(attempt => {\r\n            // Include attempts that match the guestId OR strictly anonymous attempts from this device (if we want to be aggressive)\r\n            // For now, let's assume we saved guestId in the attempt.\r\n            if (attempt.guestId === guestId && attempt.studentName !== realStudentName) {\r\n                updated = true;\r\n                return {\r\n                    ...attempt,\r\n                    studentName: realStudentName,\r\n                    // keep guestId for record or clear it? Keeping it is safer for now.\r\n                };\r\n            }\r\n            return attempt;\r\n        });\r\n\r\n        if (updated) {\r\n            localStorage.setItem(STORAGE_KEYS.ATTEMPTS, JSON.stringify(newAttempts));\r\n        }\r\n    } catch (e) {\r\n        console.error(\"Failed to merge attempts\", e);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]}]
