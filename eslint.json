[{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\actions\\analyzeKey.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseError' is defined but never used.","line":49,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\n\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\nexport async function analyzeAnswerImages(imageParts: string[]) {\r\n    const apiKey = process.env.GEMINI_API_KEY;\r\n    if (!apiKey) {\r\n        throw new Error(\"GEMINI_API_KEY is not defined in environment variables\");\r\n    }\r\n\r\n    const genAI = new GoogleGenerativeAI(apiKey);\r\n    const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n\r\n    const prompt = `\r\n    You are an expert OMR answer key extractor. \r\n    Analyze the following images which contain an answer key for an exam.\r\n    Extract the Question Number and the Correct Answer.\r\n    \r\n    Rules:\r\n    1. Answers might be numbers (1-5) or alphabets (A-E). Map alphabets to numbers: A=1, B=2, C=3, D=4, E=5.\r\n    2. Ignore headers, footers, or irrelevant text.\r\n    3. Return ONLY a valid JSON array of objects.\r\n    4. Format: [{\"questionNum\": 1, \"answer\": 3}, {\"questionNum\": 2, \"answer\": 1}, ...]\r\n    5. Ensure the numbers are integers.\r\n    `;\r\n\r\n    try {\r\n        // Convert base64 strings to GenerativeContent parts\r\n        const generatedContent = await model.generateContent([\r\n            prompt,\r\n            ...imageParts.map(img => ({\r\n                inlineData: {\r\n                    data: img.split(',')[1], // Remove \"data:image/png;base64,\" prefix\r\n                    mimeType: \"image/png\"\r\n                }\r\n            }))\r\n        ]);\r\n\r\n        const response = await generatedContent.response;\r\n        const text = response.text();\r\n        console.log(\"Gemini Raw Response:\", text);\r\n\r\n        // More robust JSON extraction\r\n        const jsonMatch = text.match(/\\[\\s*{[\\s\\S]*}\\s*\\]/);\r\n        const jsonStr = jsonMatch ? jsonMatch[0] : text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n\r\n        try {\r\n            return JSON.parse(jsonStr);\r\n        } catch (parseError) {\r\n            console.error(\"JSON Parse Error. Raw Text:\", text);\r\n            throw new Error(\"AIê°€ ìœ íš¨í•œ ì •ë‹µ í˜•ì‹ì„ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Gemini API Error:\", error);\r\n        throw new Error(\"Failed to analyze images with Gemini\");\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\create\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3726,3729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3726,3729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\groups\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\groups\\page.tsx:14:13\n  12 |         const stored = localStorage.getItem('omr_groups');\n  13 |         if (stored) {\n> 14 |             setGroups(JSON.parse(stored));\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  15 |         }\n  16 |     }, []);\n  17 |","line":14,"column":13,"nodeType":null,"endLine":14,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { Group } from \"@/types/omr\";\r\n\r\nexport default function GroupsPage() {\r\n    const [groups, setGroups] = useState<Group[]>([]);\r\n    const [newGroupName, setNewGroupName] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        const stored = localStorage.getItem('omr_groups');\r\n        if (stored) {\r\n            setGroups(JSON.parse(stored));\r\n        }\r\n    }, []);\r\n\r\n    const handleCreateGroup = () => {\r\n        if (!newGroupName.trim()) return;\r\n\r\n        const newGroup: Group = {\r\n            id: Date.now().toString(),\r\n            name: newGroupName,\r\n            studentCount: 0, // Mock for now\r\n            createdAt: new Date().toISOString()\r\n        };\r\n\r\n        const updated = [...groups, newGroup];\r\n        setGroups(updated);\r\n        localStorage.setItem('omr_groups', JSON.stringify(updated));\r\n        setNewGroupName(\"\");\r\n    };\r\n\r\n    const handleDeleteGroup = (id: string) => {\r\n        if (!confirm(\"ì •ë§ ì´ ê·¸ë£¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\")) return;\r\n        const updated = groups.filter(g => g.id !== id);\r\n        setGroups(updated);\r\n        localStorage.setItem('omr_groups', JSON.stringify(updated));\r\n    };\r\n\r\n    return (\r\n        <div className=\"layout-main\" style={{ minHeight: '100vh', background: '#f8fafc' }}>\r\n            <header className=\"header\" style={{ background: 'white', borderBottom: '1px solid #e2e8f0' }}>\r\n                <div className=\"container header-content\">\r\n                    <Link href=\"/\" className=\"logo\">OMR Maker</Link>\r\n                    <nav>\r\n                        <Link href=\"/groups\" className=\"nav-link\" style={{ fontWeight: 'bold', color: 'var(--primary)' }}>\r\n                            ê·¸ë£¹ ê´€ë¦¬\r\n                        </Link>\r\n                    </nav>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"container\" style={{ padding: '2rem 1rem', maxWidth: '800px', margin: '0 auto' }}>\r\n                <h1 style={{ fontSize: '1.8rem', fontWeight: 700, marginBottom: '2rem', color: '#1e293b' }}>\r\n                    ğŸ‘¥ ê·¸ë£¹ ê´€ë¦¬\r\n                </h1>\r\n\r\n                {/* Create Section */}\r\n                <div style={{ background: 'white', padding: '1.5rem', borderRadius: '12px', boxShadow: '0 2px 4px rgba(0,0,0,0.05)', marginBottom: '2rem', display: 'flex', gap: '1rem' }}>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={newGroupName}\r\n                        onChange={(e) => setNewGroupName(e.target.value)}\r\n                        placeholder=\"ìƒˆ ê·¸ë£¹ ì´ë¦„ (ì˜ˆ: 3í•™ë…„ 2ë°˜)\"\r\n                        className=\"input-field\"\r\n                        style={{ flex: 1, padding: '0.8rem', borderRadius: '8px', border: '1px solid #e2e8f0' }}\r\n                    />\r\n                    <button\r\n                        onClick={handleCreateGroup}\r\n                        className=\"btn btn-primary\"\r\n                        disabled={!newGroupName.trim()}\r\n                    >\r\n                        + ê·¸ë£¹ ìƒì„±\r\n                    </button>\r\n                </div>\r\n\r\n                {/* List Section */}\r\n                {groups.length === 0 ? (\r\n                    <div style={{ textAlign: 'center', color: '#94a3b8', padding: '3rem' }}>\r\n                        ìƒì„±ëœ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.\r\n                    </div>\r\n                ) : (\r\n                    <div style={{ display: 'grid', gap: '1rem' }}>\r\n                        {groups.map(group => (\r\n                            <div key={group.id} style={{ background: 'white', padding: '1.5rem', borderRadius: '12px', border: '1px solid #e2e8f0', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                <div>\r\n                                    <h3 style={{ fontSize: '1.1rem', fontWeight: 600, color: '#0f172a' }}>{group.name}</h3>\r\n                                    <p style={{ color: '#64748b', fontSize: '0.9rem' }}>í•™ìƒ ìˆ˜: {group.studentCount}ëª… | ìƒì„±ì¼: {new Date(group.createdAt).toLocaleDateString()}</p>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => handleDeleteGroup(group.id)}\r\n                                    className=\"btn btn-secondary\"\r\n                                    style={{ color: '#ef4444', borderColor: '#fee2e2', background: '#fef2f2' }}\r\n                                >\r\n                                    ì‚­ì œ\r\n                                </button>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[60,89],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\page.tsx:23:17\n  21 |     // Load Groups for Student Login\n  22 |     const stored = localStorage.getItem('omr_groups');\n> 23 |     if (stored) setGroups(JSON.parse(stored));\n     |                 ^^^^^^^^^ Avoid calling setState() directly within an effect\n  24 |   }, []);\n  25 |\n  26 |   const handleTeacherLogin = () => {","line":23,"column":17,"nodeType":null,"endLine":23,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { Group } from \"@/types/omr\";\n\nexport default function Home() {\n  const router = useRouter();\n  const [role, setRole] = useState<'none' | 'teacher' | 'student'>('none');\n\n  // Student Login State\n  const [studentName, setStudentName] = useState(\"\");\n  const [selectedGroupId, setSelectedGroupId] = useState(\"\");\n  const [groups, setGroups] = useState<Group[]>([]);\n\n  // Teacher Login State\n  const [password, setPassword] = useState(\"\");\n\n  useEffect(() => {\n    // Load Groups for Student Login\n    const stored = localStorage.getItem('omr_groups');\n    if (stored) setGroups(JSON.parse(stored));\n  }, []);\n\n  const handleTeacherLogin = () => {\n    if (password === \"admin123\") {\n      router.push(\"/teacher/dashboard\");\n    } else {\n      alert(\"Invalid Password (Try: admin123)\");\n    }\n  };\n\n  const handleStudentLogin = () => {\n    if (!studentName.trim() || !selectedGroupId) {\n      alert(\"ì´ë¦„ê³¼ ê·¸ë£¹ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.\");\n      return;\n    }\n    const group = groups.find(g => g.id === selectedGroupId);\n    const session = {\n      name: studentName,\n      groupId: selectedGroupId,\n      groupName: group?.name || \"Unknown\"\n    };\n    sessionStorage.setItem(\"omr_student_session\", JSON.stringify(session));\n    router.push(\"/student/dashboard\");\n  };\n\n  return (\n    <div className=\"layout-main center-content\">\n\n      <div className=\"container animate-fade-in\" style={{ maxWidth: '900px' }}>\n\n        {/* Header Section */}\n        <div style={{ textAlign: 'center', marginBottom: '5rem' }}>\n          <h1 className=\"title-gradient\" style={{ fontSize: '4.5rem', marginBottom: '1.5rem', lineHeight: 1.1, letterSpacing: '-0.03em' }}>\n            OMR Maker\n          </h1>\n          <p style={{ fontSize: '1.4rem', color: 'var(--muted)', fontWeight: 300 }}>\n            Smart Evaluation Platform for Schools\n          </p>\n        </div>\n\n        {/* Role Selection Cards */}\n        {role === 'none' && (\n          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '2.5rem' }}>\n            {/* Student Card */}\n            <div\n              onClick={() => setRole('student')}\n              className=\"glass-panel card-hover\"\n              style={{\n                padding: '4rem 2rem', textAlign: 'center',\n                display: 'flex', flexDirection: 'column', alignItems: 'center'\n              }}\n            >\n              <div style={{ fontSize: '5rem', marginBottom: '1.5rem', filter: 'drop-shadow(0 4px 6px rgba(0,0,0,0.1))' }}>ğŸ“</div>\n              <h2 style={{ fontSize: '1.75rem', fontWeight: 700, marginBottom: '0.75rem' }}>Student</h2>\n              <p style={{ color: 'var(--muted)', fontSize: '1.1rem' }}>Access your assignments and check results.</p>\n            </div>\n\n            {/* Teacher Card */}\n            <div\n              onClick={() => setRole('teacher')}\n              className=\"glass-panel card-hover\"\n              style={{\n                padding: '4rem 2rem', textAlign: 'center',\n                display: 'flex', flexDirection: 'column', alignItems: 'center'\n              }}\n            >\n              <div style={{ fontSize: '5rem', marginBottom: '1.5rem', filter: 'drop-shadow(0 4px 6px rgba(0,0,0,0.1))' }}>ğŸ‘¨â€ğŸ«</div>\n              <h2 style={{ fontSize: '1.75rem', fontWeight: 700, marginBottom: '0.75rem' }}>Teacher</h2>\n              <p style={{ color: 'var(--muted)', fontSize: '1.1rem' }}>Manage exams, view analytics, and grade.</p>\n            </div>\n          </div>\n        )}\n\n        {/* Login Forms */}\n        {role !== 'none' && (\n          <div className=\"glass-panel animate-slide-up\" style={{ maxWidth: '420px', margin: '0 auto', padding: '3rem 2.5rem' }}>\n            <button\n              onClick={() => setRole('none')}\n              style={{\n                marginBottom: '2rem', fontSize: '0.95rem', color: 'var(--muted)',\n                display: 'flex', alignItems: 'center', gap: '0.5rem',\n                fontWeight: 500, transition: 'color 0.2s'\n              }}\n              onMouseEnter={(e) => e.currentTarget.style.color = 'var(--primary)'}\n              onMouseLeave={(e) => e.currentTarget.style.color = 'var(--muted)'}\n            >\n              â† Back to role selection\n            </button>\n\n            {role === 'teacher' ? (\n              <div>\n                <h2 style={{ fontSize: '1.8rem', marginBottom: '2rem', fontWeight: 800, color: 'var(--foreground)' }}>Teacher Access</h2>\n                <div style={{ marginBottom: '2rem' }}>\n                  <label style={{ display: 'block', marginBottom: '0.75rem', fontSize: '0.95rem', fontWeight: 600, color: 'var(--muted)' }}>Password</label>\n                  <input\n                    type=\"password\"\n                    className=\"input-field\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    onKeyDown={(e) => e.key === 'Enter' && handleTeacherLogin()}\n                    placeholder=\"Enter password\"\n                  />\n                  <div style={{ fontSize: '0.85rem', color: 'var(--muted)', marginTop: '0.75rem' }}>Hint: admin123</div>\n                </div>\n                <button\n                  onClick={handleTeacherLogin}\n                  className=\"btn btn-primary\"\n                  style={{ width: '100%' }}\n                >\n                  Enter Dashboard\n                </button>\n              </div>\n            ) : (\n              <div>\n                <h2 style={{ fontSize: '1.8rem', marginBottom: '2rem', fontWeight: 800, color: 'var(--foreground)' }}>Student Login</h2>\n                <div style={{ marginBottom: '1.5rem' }}>\n                  <label style={{ display: 'block', marginBottom: '0.75rem', fontSize: '0.95rem', fontWeight: 600, color: 'var(--muted)' }}>Name</label>\n                  <input\n                    type=\"text\"\n                    className=\"input-field\"\n                    value={studentName}\n                    onChange={(e) => setStudentName(e.target.value)}\n                    placeholder=\"e.g. Kim Minji\"\n                  />\n                </div>\n                <div style={{ marginBottom: '2.5rem' }}>\n                  <label style={{ display: 'block', marginBottom: '0.75rem', fontSize: '0.95rem', fontWeight: 600, color: 'var(--muted)' }}>Select Class</label>\n                  <select\n                    value={selectedGroupId}\n                    onChange={(e) => setSelectedGroupId(e.target.value)}\n                    className=\"input-field\"\n                    style={{ cursor: 'pointer' }}\n                  >\n                    <option value=\"\">-- Select Group --</option>\n                    {groups.map(g => (\n                      <option key={g.id} value={g.id}>{g.name}</option>\n                    ))}\n                  </select>\n                  {groups.length === 0 && (\n                    <div style={{ fontSize: '0.85rem', color: 'var(--error)', marginTop: '0.75rem', background: 'rgba(239, 68, 68, 0.1)', padding: '0.5rem', borderRadius: 'var(--radius-md)' }}>\n                      No groups found. Please ask teacher to create groups first.\n                    </div>\n                  )}\n                </div>\n                <button\n                  onClick={handleStudentLogin}\n                  className=\"btn btn-primary\"\n                  style={{ width: '100%', background: 'linear-gradient(135deg, var(--secondary), var(--secondary-light))', boxShadow: '0 4px 15px rgba(236, 72, 153, 0.4)', marginBottom: '1rem' }}\n                >\n                  Start Learning\n                </button>\n\n                <div style={{ position: 'relative', textAlign: 'center', margin: '1.5rem 0' }}>\n                  <hr style={{ borderColor: 'var(--border)' }} />\n                  <span style={{ position: 'absolute', top: '-10px', left: '50%', transform: 'translateX(-50%)', background: 'var(--surface-glass)', padding: '0 0.5rem', fontSize: '0.8rem', color: 'var(--muted)' }}>OR</span>\n                </div>\n\n                <button\n                  onClick={() => {\n                    const guestId = Math.random().toString(36).substring(2, 15);\n                    const session = {\n                      name: \"Guest Student\",\n                      isGuest: true,\n                      guestId: guestId,\n                      groupName: \"Guest Mode\"\n                    };\n                    sessionStorage.setItem(\"omr_student_session\", JSON.stringify(session));\n                    localStorage.setItem(\"omr_guest_id\", guestId); // Persist for merging later\n                    router.push(\"/student/dashboard\");\n                  }}\n                  className=\"btn\"\n                  style={{\n                    width: '100%',\n                    background: 'transparent',\n                    border: '1px solid var(--border)',\n                    color: 'var(--muted)',\n                    fontSize: '0.9rem'\n                  }}\n                >\n                  Continue as Guest\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\solve\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isAuthorized' is assigned a value but never used.","line":21,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedGroupId' is assigned a value but never used.","line":22,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'availableGroups' is assigned a value but never used.","line":24,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":86,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'checkGroupAccess' is assigned a value but never used.","line":190,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":190,"endColumn":27}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1108,1111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1108,1111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport OMRPreview from \"@/components/OMRPreview\";\r\nimport dynamic from \"next/dynamic\";\r\n\r\nconst PDFViewer = dynamic(() => import(\"@/components/PDFViewer\"), { ssr: false });\r\nimport { Question } from \"@/types/omr\";\r\n\r\nexport default function SolvePage() {\r\n    const params = useParams();\r\n    const id = params?.id as string;\r\n\r\n    const [examData, setExamData] = useState<{ title: string; questions: Question[]; accessConfig?: { type: string; groupIds: string[] } } | null>(null);\r\n    const [studentAnswers, setStudentAnswers] = useState<Record<number, number>>({});\r\n    const [drawings, setDrawings] = useState<Record<number, string[]>>({});\r\n    const [pdfFile, setPdfFile] = useState<File | null>(null);\r\n\r\n    const [isAuthorized, setIsAuthorized] = useState(false);\r\n    const [selectedGroupId, setSelectedGroupId] = useState(\"\");\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    const [availableGroups, setAvailableGroups] = useState<any[]>([]);\r\n    const [user, setUser] = useState<{ name: string; isGuest?: boolean; guestId?: string } | null>(null);\r\n\r\n    // Navigation State\r\n    const [currentQuestionId, setCurrentQuestionId] = useState<number | null>(null);\r\n    const [pdfCurrentPage, setPdfCurrentPage] = useState<number | undefined>(undefined);\r\n\r\n    // Teacher Mode State\r\n    const [isTeacherMode, setIsTeacherMode] = useState(false);\r\n    const [activeTab, setActiveTab] = useState<'problem' | 'answer'>('problem');\r\n    const [answerFile, setAnswerFile] = useState<File | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Load User Session\r\n        const sessionStr = sessionStorage.getItem(\"omr_student_session\");\r\n        if (sessionStr) {\r\n            setUser(JSON.parse(sessionStr));\r\n        }\r\n\r\n        const loadExam = async () => {\r\n            if (id) {\r\n                const data = localStorage.getItem(`omr_exam_${id}`);\r\n                if (data) {\r\n                    try {\r\n                        const parsed = JSON.parse(data);\r\n                        setExamData(parsed);\r\n\r\n                        // Convert base64 pdfData (Problem PDF) back to File\r\n                        if (parsed.pdfData) {\r\n                            try {\r\n                                const fetchRes = await fetch(parsed.pdfData);\r\n                                const blob = await fetchRes.blob();\r\n                                const file = new File([blob], \"problem.pdf\", { type: \"application/pdf\" });\r\n                                setPdfFile(file);\r\n                            } catch (err) {\r\n                                console.error(\"Failed to load problem PDF\", err);\r\n                            }\r\n                        }\r\n\r\n                        // Convert base64 answerKeyPdf back to File\r\n                        if (parsed.answerKeyPdf) {\r\n                            try {\r\n                                const fetchRes = await fetch(parsed.answerKeyPdf);\r\n                                const blob = await fetchRes.blob();\r\n                                const file = new File([blob], \"answer_key.pdf\", { type: \"application/pdf\" });\r\n                                setAnswerFile(file);\r\n                            } catch (err) {\r\n                                console.error(\"Failed to load answer key PDF\", err);\r\n                            }\r\n                        }\r\n\r\n                        // Check Access Control\r\n                        if (parsed.accessConfig?.type === 'group') {\r\n                            setIsAuthorized(false);\r\n                            // Load groups for selection (Simulation of \"User's Groups\")\r\n                            const groups = localStorage.getItem('omr_groups');\r\n                            if (groups) {\r\n                                setAvailableGroups(JSON.parse(groups));\r\n                            }\r\n                        } else {\r\n                            setIsAuthorized(true);\r\n                        }\r\n                    } catch (e) {\r\n                        alert(\"ì‹œí—˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨\");\r\n                    }\r\n                } else {\r\n                    alert(\"ìœ íš¨í•˜ì§€ ì•Šì€ ì‹œí—˜ IDì´ê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\");\r\n                }\r\n            }\r\n        };\r\n\r\n        loadExam();\r\n    }, [id]);\r\n\r\n    const handleAnswerClick = (qId: number, optionIndex: number) => {\r\n        setStudentAnswers(prev => ({\r\n            ...prev,\r\n            [qId]: optionIndex\r\n        }));\r\n        // Auto-select question when answering\r\n        handleQuestionClick(qId);\r\n    };\r\n\r\n    const handleQuestionClick = (qId: number) => {\r\n        setCurrentQuestionId(qId);\r\n        if (examData) {\r\n            const q = examData.questions.find(q => q.id === qId);\r\n            if (q?.pdfLocation?.page) {\r\n                setPdfCurrentPage(q.pdfLocation.page);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleDrawingsChange = (page: number, newPaths: string[]) => {\r\n        setDrawings(prev => ({\r\n            ...prev,\r\n            [page]: newPaths\r\n        }));\r\n    };\r\n\r\n\r\n\r\n    // ... (intermediate code) ...\r\n\r\n    const handleSubmit = () => {\r\n        if (!confirm(\"ì •ë§ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (í˜„ì¬ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤)\")) return;\r\n\r\n        if (!examData) return;\r\n\r\n        // Ensure User\r\n        let submitter = user;\r\n        if (!submitter) {\r\n            // Guest Flow for Public Exams\r\n            if (examData.accessConfig?.type === 'public') {\r\n                const name = prompt(\"ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ê²ŒìŠ¤íŠ¸ ì œì¶œ):\");\r\n                if (!name) return;\r\n                const guestId = Math.random().toString(36).substring(2, 15);\r\n                submitter = { name, isGuest: true, guestId };\r\n                // Save session for continuity\r\n                sessionStorage.setItem(\"omr_student_session\", JSON.stringify({ ...submitter, groupName: 'Guest' }));\r\n                localStorage.setItem(\"omr_guest_id\", guestId);\r\n            } else {\r\n                alert(\"ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì‹œí—˜ì…ë‹ˆë‹¤.\");\r\n                window.location.href = \"/\";\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Calculate Score\r\n        let correctCount = 0;\r\n        let totalCount = 0;\r\n\r\n        examData.questions.forEach(q => {\r\n            if (q.answer) {\r\n                totalCount++;\r\n                if (studentAnswers[q.id] === q.answer) {\r\n                    correctCount++;\r\n                }\r\n            }\r\n        });\r\n\r\n        const attemptId = Date.now().toString();\r\n        const attemptData = {\r\n            id: attemptId,\r\n            examId: id,\r\n            examTitle: examData.title,\r\n            studentName: submitter.name,\r\n            guestId: submitter.guestId, // Track Guest ID\r\n            startedAt: new Date().toISOString(),\r\n            finishedAt: new Date().toISOString(),\r\n            score: correctCount,\r\n            totalScore: totalCount,\r\n            answers: studentAnswers,\r\n            drawings: drawings,\r\n            status: 'completed'\r\n        };\r\n\r\n        // Save to Local Storage (List of attempts)\r\n        const history = JSON.parse(localStorage.getItem('omr_attempts') || '[]');\r\n        history.push(attemptData);\r\n        localStorage.setItem('omr_attempts', JSON.stringify(history));\r\n\r\n        alert(`ì œì¶œ ì™„ë£Œ! ì ìˆ˜: ${correctCount}/${totalCount}`);\r\n        window.location.href = `/student/review/${attemptId}`;\r\n    };\r\n\r\n    const checkGroupAccess = () => {\r\n        if (!examData?.accessConfig?.groupIds) return;\r\n\r\n        if (examData.accessConfig.groupIds.includes(selectedGroupId)) {\r\n            setIsAuthorized(true);\r\n        } else {\r\n            alert(\"ì´ ì‹œí—˜ì— ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê·¸ë£¹ì…ë‹ˆë‹¤.\");\r\n        }\r\n    };\r\n\r\n    const toggleTeacherMode = (checked: boolean) => {\r\n        if (checked) {\r\n            const password = prompt(\"ì„ ìƒë‹˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ê¸°ë³¸: admin123)\");\r\n            if (password === \"admin123\") {\r\n                setIsTeacherMode(true);\r\n            } else {\r\n                alert(\"ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.\");\r\n                setIsTeacherMode(false);\r\n            }\r\n        } else {\r\n            setIsTeacherMode(false);\r\n        }\r\n    };\r\n\r\n    if (!examData) {\r\n        return (\r\n            <div style={{ padding: '2rem', textAlign: 'center' }}>\r\n                <h2>ì‹œí—˜ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>\r\n                <Link href=\"/\" className=\"btn btn-secondary\">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</Link>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"layout-main\" style={{ background: '#f1f5f9', height: '100vh', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\r\n            <header className=\"header\" style={{ flexShrink: 0, justifyContent: 'space-between' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                    <div className=\"logo\" style={{ fontSize: '1.2rem' }}>Answer Mode</div>\r\n                    <span style={{ fontSize: '0.9rem', color: '#666' }}>ID: {id}</span>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.85rem', cursor: 'pointer', background: 'rgba(0,0,0,0.05)', padding: '0.3rem 0.6rem', borderRadius: '4px' }}>\r\n                        <input type=\"checkbox\" checked={isTeacherMode} onChange={(e) => toggleTeacherMode(e.target.checked)} />\r\n                        ì„ ìƒë‹˜ ëª¨ë“œ\r\n                    </label>\r\n\r\n                    {/* Teacher Mode Specific Controls */}\r\n                    {isTeacherMode ? (\r\n                        <div style={{ display: 'flex', background: '#e2e8f0', borderRadius: '4px', padding: '2px' }}>\r\n                            <button\r\n                                onClick={() => setActiveTab('problem')}\r\n                                style={{ padding: '0.3rem 0.8rem', fontSize: '0.85rem', borderRadius: '4px', border: 'none', background: activeTab === 'problem' ? 'white' : 'transparent', fontWeight: activeTab === 'problem' ? 'bold' : 'normal', cursor: 'pointer' }}\r\n                            >\r\n                                ë¬¸ì œì§€\r\n                            </button>\r\n                            <button\r\n                                onClick={() => setActiveTab('answer')}\r\n                                style={{ padding: '0.3rem 0.8rem', fontSize: '0.85rem', borderRadius: '4px', border: 'none', background: activeTab === 'answer' ? 'white' : 'transparent', fontWeight: activeTab === 'answer' ? 'bold' : 'normal', cursor: 'pointer' }}\r\n                            >\r\n                                ì •ë‹µ/í•´ì„¤\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <label className=\"btn btn-secondary\" style={{ cursor: 'pointer', fontSize: '0.85rem' }}>\r\n                            ğŸ“„ ë¬¸ì œì§€(PDF) ì—´ê¸°\r\n                            <input id=\"pdf-upload-input\" type=\"file\" accept=\".pdf\" onChange={(e) => e.target.files && setPdfFile(e.target.files[0])} style={{ display: 'none' }} />\r\n                        </label>\r\n                    )}\r\n\r\n                    <button className=\"btn btn-primary\" onClick={handleSubmit}>\r\n                        âœ… ì œì¶œí•˜ê¸°\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div style={{ display: 'flex', flex: 1, overflow: 'hidden' }}>\r\n                {/* PDF ViewerArea (Left) */}\r\n                <div style={{ flex: 1, borderRight: '1px solid #ddd', background: '#222', position: 'relative', display: 'flex', flexDirection: 'column' }}>\r\n                    {/* Tab Context specific toolbar */}\r\n                    {isTeacherMode && activeTab === 'answer' && !answerFile && (\r\n                        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10, pointerEvents: 'none' }}>\r\n                            <label className=\"btn btn-primary\" style={{ pointerEvents: 'auto', cursor: 'pointer', boxShadow: '0 4px 10px rgba(0,0,0,0.3)' }}>\r\n                                ğŸ“ í•´ì„¤/ì •ë‹µ PDF ì—…ë¡œë“œ\r\n                                <input type=\"file\" accept=\".pdf\" onChange={(e) => e.target.files && setAnswerFile(e.target.files[0])} style={{ display: 'none' }} />\r\n                            </label>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isTeacherMode && activeTab === 'problem' && !pdfFile && (\r\n                        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10, pointerEvents: 'none' }}>\r\n                            <label className=\"btn btn-secondary\" style={{ pointerEvents: 'auto', cursor: 'pointer', boxShadow: '0 4px 10px rgba(0,0,0,0.3)' }}>\r\n                                ğŸ“„ ë¬¸ì œì§€ PDF ì—…ë¡œë“œ\r\n                                <input type=\"file\" accept=\".pdf\" onChange={(e) => e.target.files && setPdfFile(e.target.files[0])} style={{ display: 'none' }} />\r\n                            </label>\r\n                        </div>\r\n                    )}\r\n\r\n                    <PDFViewer\r\n                        file={activeTab === 'problem' ? pdfFile : answerFile}\r\n                        onLoadSuccess={() => { }}\r\n                        onFileDrop={activeTab === 'problem' ? setPdfFile : setAnswerFile}\r\n                        enableDrawing={true}\r\n                        drawings={drawings}\r\n                        onDrawingsChange={handleDrawingsChange}\r\n                        forcePage={activeTab === 'problem' ? pdfCurrentPage : undefined}\r\n                        markers={(activeTab === 'problem' && examData.questions)\r\n                            ? examData.questions\r\n                                .filter((q: Question) => q.pdfLocation)\r\n                                .map((q: Question) => ({\r\n                                    page: q.pdfLocation!.page,\r\n                                    x: q.pdfLocation!.x,\r\n                                    y: q.pdfLocation!.y,\r\n                                    label: q.number,\r\n                                    color: currentQuestionId === q.id ? '#6366f1' : '#ef4444',\r\n                                    onClick: () => handleQuestionClick(q.id)\r\n                                }))\r\n                            : []}\r\n                    />\r\n                </div>\r\n\r\n                {/* OMR Sheet (Right) */}\r\n                <div style={{ flex: 1, display: 'flex', justifyContent: 'center', overflowY: 'auto', padding: '2rem', background: '#e2e8f0' }}>\r\n                    <div style={{ transform: 'scale(0.9)', transformOrigin: 'top center', height: 'fit-content' }}>\r\n                        <OMRPreview\r\n                            title={examData.title}\r\n                            questions={examData.questions}\r\n                            mode=\"solve\"\r\n                            userAnswers={studentAnswers}\r\n                            selectedQuestionId={currentQuestionId}\r\n                            onAnswerClick={handleAnswerClick}\r\n                            onQuestionClick={handleQuestionClick}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\dashboard\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\dashboard\\page.tsx:30:9\n  28 |         }\n  29 |         const currentUser = JSON.parse(session);\n> 30 |         setUser(currentUser);\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  31 |\n  32 |         // 2. Load Data\n  33 |         const allExams: Exam[] = [];","line":30,"column":9,"nodeType":null,"endLine":30,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":39,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Exam, Attempt } from \"@/types/omr\";\r\nimport AssignmentBlock from \"@/components/dashboard/AssignmentBlock\";\r\n\r\nimport { mergeGuestAttempts } from \"@/utils/storage\";\r\n\r\nexport default function StudentDashboard() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState<{ name: string; groupId: string; groupName: string; isGuest?: boolean; guestId?: string } | null>(null);\r\n    const [todoExams, setTodoExams] = useState<Exam[]>([]);\r\n    const [doneExams, setDoneExams] = useState<(Exam & { attemptId: string })[]>([]);\r\n    const [stats, setStats] = useState({\r\n        avgScore: 0,\r\n        completedCount: 0\r\n    });\r\n\r\n    useEffect(() => {\r\n        // 1. Check Session (Simulated)\r\n        const session = sessionStorage.getItem(\"omr_student_session\");\r\n        if (!session) {\r\n            alert(\"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\");\r\n            router.push(\"/\");\r\n            return;\r\n        }\r\n        const currentUser = JSON.parse(session);\r\n        setUser(currentUser);\r\n\r\n        // 2. Load Data\r\n        const allExams: Exam[] = [];\r\n        for (let i = 0; i < localStorage.length; i++) {\r\n            const key = localStorage.key(i);\r\n            if (key?.startsWith(\"omr_exam_\")) {\r\n                try {\r\n                    allExams.push(JSON.parse(localStorage.getItem(key) || \"\"));\r\n                } catch (e) { }\r\n            }\r\n        }\r\n\r\n        const allAttempts: Attempt[] = JSON.parse(localStorage.getItem(\"omr_attempts\") || \"[]\");\r\n\r\n        // Filter attempts: by guestId if guest, or by name if logged in\r\n        // In a real app, we'd use IDs for everything.\r\n        const myAttempts = allAttempts.filter(a => {\r\n            if (currentUser.isGuest) {\r\n                return a.guestId === currentUser.guestId;\r\n            } else {\r\n                return a.studentName === currentUser.name;\r\n                // Note: IF we just merged, we might want to also check matches that WERE guestIds? \r\n                // For now, assume merge updates studentName.\r\n            }\r\n        });\r\n\r\n        // 3. Categorize Exams\r\n        const done: (Exam & { attemptId: string })[] = [];\r\n        const todo: Exam[] = [];\r\n\r\n        allExams.forEach(exam => {\r\n            // Check Access\r\n            let hasAccess = false;\r\n            // Public exams are accessible to everyone\r\n            if (exam.accessConfig?.type === 'public') hasAccess = true;\r\n            // Group exams check if user's group is in the list. Guests only see public.\r\n            else if (currentUser.isGuest) hasAccess = false;\r\n            else if (exam.accessConfig?.groupIds?.includes(currentUser.groupId)) hasAccess = true;\r\n\r\n            if (!hasAccess) return;\r\n\r\n            // Check if completed\r\n            const attempt = myAttempts.find(a => a.examId === exam.id);\r\n            if (attempt) {\r\n                done.push({ ...exam, attemptId: attempt.id });\r\n            } else {\r\n                todo.push(exam);\r\n            }\r\n        });\r\n\r\n        setTodoExams(todo);\r\n        setDoneExams(done);\r\n\r\n        // 4. Calculate Stats\r\n        const totalScore = myAttempts.reduce((acc, curr) => acc + (curr.score / curr.totalScore) * 100, 0);\r\n        const avg = myAttempts.length > 0 ? Math.round(totalScore / myAttempts.length) : 0;\r\n        setStats({\r\n            avgScore: avg,\r\n            completedCount: myAttempts.length\r\n        });\r\n\r\n    }, [router]);\r\n\r\n    const handleMergeAccount = () => {\r\n        // Mocking a flow where guest logs in\r\n        const name = prompt(\"Enter your name to sign up/login:\");\r\n        if (!name) return;\r\n\r\n        // 1. Simulate new session\r\n        const newSession = {\r\n            name: name,\r\n            groupId: \"group-1\", // mock group\r\n            groupName: \"Class A\",\r\n            isGuest: false\r\n        };\r\n\r\n        // 2. Perform Merge\r\n        if (user?.guestId) {\r\n            mergeGuestAttempts(user.guestId, name);\r\n            alert(`History merged to ${name}!`);\r\n        }\r\n\r\n        sessionStorage.setItem(\"omr_student_session\", JSON.stringify(newSession));\r\n        window.location.reload(); // Reload to refresh data\r\n    };\r\n\r\n    if (!user) return <div style={{ padding: '2rem' }}>Loading...</div>;\r\n\r\n    return (\r\n        <div className=\"layout-main\">\r\n            <header className=\"header\">\r\n                <div className=\"container header-content\">\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                        <Link href=\"/\" className=\"logo\">OMR Maker</Link>\r\n                        <span style={{\r\n                            fontSize: '0.75rem', fontWeight: 700,\r\n                            background: 'rgba(236, 72, 153, 0.1)', color: 'var(--secondary)',\r\n                            padding: '4px 10px', borderRadius: 'var(--radius-full)',\r\n                            border: '1px solid rgba(236, 72, 153, 0.2)'\r\n                        }}>\r\n                            {user.isGuest ? \"GUEST\" : \"STUDENT\"}\r\n                        </span>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem' }}>\r\n                        <span style={{ fontWeight: 600, fontSize: '0.95rem' }}>\r\n                            {user.name} <span style={{ color: 'var(--muted)', fontWeight: 400 }}>({user.groupName})</span>\r\n                        </span>\r\n                        <button onClick={() => {\r\n                            if (confirm(\"Logout?\")) {\r\n                                sessionStorage.removeItem(\"omr_student_session\");\r\n                                router.push(\"/\");\r\n                            }\r\n                        }} style={{ fontSize: '0.9rem', color: 'var(--muted)', cursor: 'pointer', transition: 'color 0.2s', fontWeight: 500 }}>\r\n                            Logout\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"container animate-fade-in\" style={{ paddingBottom: '4rem' }}>\r\n\r\n                {/* Guest Banner */}\r\n                {user.isGuest && (\r\n                    <div className=\"animate-slide-up\" style={{\r\n                        margin: '2rem 0 1rem', padding: '1.5rem',\r\n                        background: 'linear-gradient(to right, #4f46e5, #8b5cf6)',\r\n                        borderRadius: 'var(--radius-lg)', color: 'white',\r\n                        display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                        boxShadow: '0 10px 25px -5px rgba(79, 70, 229, 0.4)'\r\n                    }}>\r\n                        <div>\r\n                            <h3 style={{ fontSize: '1.2rem', fontWeight: 700, marginBottom: '0.25rem' }}>Save your progress!</h3>\r\n                            <p style={{ opacity: 0.9, fontSize: '0.95rem' }}>Create an account to keep your exam history forever.</p>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleMergeAccount}\r\n                            className=\"btn\"\r\n                            style={{\r\n                                background: 'white', color: 'var(--primary)',\r\n                                fontWeight: 700, border: 'none',\r\n                                padding: '0.75rem 1.5rem', fontSize: '0.95rem'\r\n                            }}\r\n                        >\r\n                            Sign Up & Merge\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Welcome */}\r\n                <div style={{ margin: '3rem 0' }}>\r\n                    <h1 className=\"title-gradient\" style={{ fontSize: '2.5rem', marginBottom: '0.75rem', lineHeight: 1.2 }}>\r\n                        Hello, {user.name}! ğŸ‘‹\r\n                    </h1>\r\n                    <p className=\"text-muted\" style={{ fontSize: '1.1rem' }}>\r\n                        You have <strong style={{ color: 'var(--primary)', fontWeight: 700 }}>{todoExams.length}</strong> assignments pending today.\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Dashboard Grid */}\r\n                <div className=\"bento-grid\">\r\n                    {/* Stats */}\r\n                    <Link href=\"/student/history\" className=\"bento-card col-span-1 card-hover\" style={{\r\n                        background: 'linear-gradient(135deg, var(--secondary), #f472b6)',\r\n                        color: 'white', border: 'none',\r\n                        display: 'flex', flexDirection: 'column', justifyContent: 'center'\r\n                    }}>\r\n                        <div style={{ fontSize: '0.95rem', fontWeight: 600, opacity: 0.9, marginBottom: '0.5rem' }}>My Average</div>\r\n                        <div style={{ fontSize: '3rem', fontWeight: 800, lineHeight: 1 }}>{stats.avgScore}</div>\r\n                        <div style={{ fontSize: '0.85rem', opacity: 0.8, marginTop: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                            View Details <span>â†’</span>\r\n                        </div>\r\n                    </Link>\r\n\r\n                    <div className=\"bento-card col-span-1\" style={{ justifyContent: 'center', alignItems: 'center', background: 'var(--surface)' }}>\r\n                        <div style={{ fontSize: '3rem', fontWeight: 800, color: 'var(--foreground)', lineHeight: 1, marginBottom: '0.5rem' }}>\r\n                            {stats.completedCount}\r\n                        </div>\r\n                        <div style={{ color: 'var(--muted)', fontSize: '0.9rem', fontWeight: 600 }}>Exams Completed</div>\r\n                    </div>\r\n\r\n                    {/* Todo List (Main Focus) */}\r\n                    <div className=\"col-span-2 row-span-2\">\r\n                        <AssignmentBlock type=\"todo\" exams={todoExams} />\r\n                    </div>\r\n\r\n                    {/* Completed List */}\r\n                    <div className=\"col-span-2\">\r\n                        <AssignmentBlock type=\"done\" exams={doneExams} />\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\history\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\history\\page.tsx:17:17\n  15 |                 // Sort by latest first\n  16 |                 parsed.sort((a: Attempt, b: Attempt) => new Date(b.finishedAt).getTime() - new Date(a.finishedAt).getTime());\n> 17 |                 setAttempts(parsed);\n     |                 ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |             } catch (e) {\n  19 |                 console.error(\"Failed to load history\", e);\n  20 |             }","line":17,"column":17,"nodeType":null,"endLine":17,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { Attempt } from \"@/types/omr\";\r\n\r\nexport default function HistoryPage() {\r\n    const [attempts, setAttempts] = useState<Attempt[]>([]);\r\n\r\n    useEffect(() => {\r\n        const data = localStorage.getItem('omr_attempts');\r\n        if (data) {\r\n            try {\r\n                const parsed = JSON.parse(data);\r\n                // Sort by latest first\r\n                parsed.sort((a: Attempt, b: Attempt) => new Date(b.finishedAt).getTime() - new Date(a.finishedAt).getTime());\r\n                setAttempts(parsed);\r\n            } catch (e) {\r\n                console.error(\"Failed to load history\", e);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"layout-main\" style={{ minHeight: '100vh', background: '#f8fafc' }}>\r\n            <header className=\"header\" style={{ background: 'white', borderBottom: '1px solid #e2e8f0' }}>\r\n                <div className=\"container header-content\">\r\n                    <Link href=\"/\" className=\"logo\">OMR Maker</Link>\r\n                    <nav>\r\n                        <Link href=\"/student/history\" className=\"nav-link\" style={{ fontWeight: 'bold', color: 'var(--primary)' }}>\r\n                            ë‚´ ì‹œí—˜ ê¸°ë¡\r\n                        </Link>\r\n                    </nav>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"container\" style={{ padding: '2rem 1rem' }}>\r\n                <h1 style={{ fontSize: '1.8rem', fontWeight: 700, marginBottom: '2rem', color: '#1e293b' }}>\r\n                    ğŸ“‹ ë‚´ ì‹œí—˜ ê¸°ë¡\r\n                </h1>\r\n\r\n                {attempts.length === 0 ? (\r\n                    <div style={{ textAlign: 'center', padding: '4rem', color: '#64748b', background: 'white', borderRadius: '12px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)' }}>\r\n                        <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>ğŸ“­</div>\r\n                        <p style={{ fontSize: '1.2rem' }}>ì•„ì§ ì‘ì‹œí•œ ì‹œí—˜ì´ ì—†ìŠµë‹ˆë‹¤.</p>\r\n                        <Link href=\"/\" className=\"btn btn-primary\" style={{ marginTop: '1.5rem', display: 'inline-block' }}>\r\n                            ì‹œí—˜ ì‘ì‹œí•˜ëŸ¬ ê°€ê¸°\r\n                        </Link>\r\n                    </div>\r\n                ) : (\r\n                    <div style={{ display: 'grid', gap: '1rem' }}>\r\n                        {attempts.map((attempt) => (\r\n                            <Link\r\n                                key={attempt.id}\r\n                                href={`/student/review/${attempt.id}`}\r\n                                style={{\r\n                                    textDecoration: 'none', color: 'inherit',\r\n                                    display: 'block',\r\n                                    background: 'white',\r\n                                    padding: '1.5rem',\r\n                                    borderRadius: '12px',\r\n                                    border: '1px solid #e2e8f0',\r\n                                    boxShadow: '0 2px 4px rgba(0,0,0,0.05)',\r\n                                    transition: 'transform 0.2s',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                                className=\"history-card\"\r\n                            >\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>\r\n                                    <h3 style={{ fontSize: '1.1rem', fontWeight: 600, color: '#0f172a' }}>{attempt.examTitle}</h3>\r\n                                    <span style={{\r\n                                        padding: '0.2rem 0.6rem', borderRadius: '999px', fontSize: '0.8rem', fontWeight: 600,\r\n                                        background: attempt.score / attempt.totalScore >= 0.8 ? '#dcfce7' : attempt.score / attempt.totalScore >= 0.5 ? '#fef9c3' : '#fee2e2',\r\n                                        color: attempt.score / attempt.totalScore >= 0.8 ? '#15803d' : attempt.score / attempt.totalScore >= 0.5 ? '#a16207' : '#b91c1c'\r\n                                    }}>\r\n                                        {attempt.score} / {attempt.totalScore} ì \r\n                                    </span>\r\n                                </div>\r\n                                <div style={{ color: '#64748b', fontSize: '0.9rem' }}>\r\n                                    ì‘ì‹œì¼: {new Date(attempt.finishedAt).toLocaleString()}\r\n                                </div>\r\n                            </Link>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\review\\[attemptId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Question' is defined but never used.","line":6,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Question"},"fix":{"range":[167,177],"text":""},"desc":"Remove unused variable \"Question\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\student\\review\\[attemptId]\\page.tsx:25:21\n  23 |                 const found = attempts.find(a => a.id === id);\n  24 |                 if (found) {\n> 25 |                     setAttempt(found);\n     |                     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |                     // Load Exam Data associated with this attempt\n  27 |                     // Note: In real app, we fetch by examId. Here we rely on the exam saving key convention.\n  28 |                     const examDataStr = localStorage.getItem(`omr_exam_${found.examId}`);","line":25,"column":21,"nodeType":null,"endLine":25,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { Attempt, Question, Exam } from \"@/types/omr\";\r\n\r\nexport default function ReviewPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const id = params?.attemptId as string;\r\n\r\n    const [attempt, setAttempt] = useState<Attempt | null>(null);\r\n    const [exam, setExam] = useState<Exam | null>(null);\r\n    const [filterWrong, setFilterWrong] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            // Load Attempt\r\n            const attemptsData = localStorage.getItem('omr_attempts');\r\n            if (attemptsData) {\r\n                const attempts: Attempt[] = JSON.parse(attemptsData);\r\n                const found = attempts.find(a => a.id === id);\r\n                if (found) {\r\n                    setAttempt(found);\r\n                    // Load Exam Data associated with this attempt\r\n                    // Note: In real app, we fetch by examId. Here we rely on the exam saving key convention.\r\n                    const examDataStr = localStorage.getItem(`omr_exam_${found.examId}`);\r\n                    if (examDataStr) {\r\n                        setExam(JSON.parse(examDataStr));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, [id]);\r\n\r\n    if (!attempt || !exam) {\r\n        return <div style={{ padding: '2rem', textAlign: 'center' }}>Loading...</div>;\r\n    }\r\n\r\n    const filteredQuestions = filterWrong\r\n        ? exam.questions.filter(q => q.answer && attempt.answers[q.id] !== q.answer)\r\n        : exam.questions;\r\n\r\n    return (\r\n        <div className=\"layout-main\" style={{ minHeight: '100vh', background: '#f8fafc' }}>\r\n            <header className=\"header\" style={{ background: 'white', borderBottom: '1px solid #e2e8f0' }}>\r\n                <div className=\"container header-content\">\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                        <button onClick={() => router.back()} style={{ border: 'none', background: 'none', fontSize: '1.2rem', cursor: 'pointer' }}>â†</button>\r\n                        <span style={{ fontWeight: 600 }}>ê²°ê³¼ ë¦¬í¬íŠ¸</span>\r\n                    </div>\r\n                    <Link href=\"/student/history\" className=\"btn btn-secondary\" style={{ fontSize: '0.9rem', padding: '0.4rem 1rem' }}>\r\n                        ëª©ë¡ìœ¼ë¡œ\r\n                    </Link>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"container\" style={{ padding: '2rem 1rem', maxWidth: '800px', margin: '0 auto' }}>\r\n                {/* Score Card */}\r\n                <div style={{ background: 'white', padding: '2rem', borderRadius: '16px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', textAlign: 'center', marginBottom: '2rem' }}>\r\n                    <h1 style={{ fontSize: '1.5rem', marginBottom: '0.5rem', fontWeight: 700 }}>{attempt.examTitle}</h1>\r\n                    <div style={{ fontSize: '3.5rem', fontWeight: 800, color: 'var(--primary)', lineHeight: 1 }}>\r\n                        {attempt.score}\r\n                        <span style={{ fontSize: '1.5rem', color: '#94a3b8', fontWeight: 500 }}> / {attempt.totalScore}</span>\r\n                    </div>\r\n                    <p style={{ color: '#64748b', marginTop: '0.5rem' }}>\r\n                        {new Date(attempt.finishedAt).toLocaleString()} ì‘ì‹œ ì™„ë£Œ\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div style={{ display: 'flex', gap: '1rem', marginBottom: '1.5rem', borderBottom: '1px solid #e2e8f0', paddingBottom: '1rem' }}>\r\n                    <button\r\n                        onClick={() => setFilterWrong(false)}\r\n                        className={`btn ${!filterWrong ? 'btn-primary' : 'btn-secondary'}`}\r\n                        style={{ borderRadius: '999px' }}\r\n                    >\r\n                        ì „ì²´ ë¬¸í•­ ({exam.questions.length})\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setFilterWrong(true)}\r\n                        className={`btn ${filterWrong ? 'btn-primary' : 'btn-secondary'}`}\r\n                        style={{ borderRadius: '999px', background: filterWrong ? '#ef4444' : undefined, color: filterWrong ? 'white' : undefined }}\r\n                    >\r\n                        ğŸš¨ ì˜¤ë‹µë§Œ ë³´ê¸° ({attempt.totalScore - attempt.score})\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Question List */}\r\n                <div style={{ display: 'grid', gap: '1rem' }}>\r\n                    {filteredQuestions.map((q) => {\r\n                        const userAns = attempt.answers[q.id];\r\n                        const isCorrect = userAns === q.answer;\r\n                        const isSkipped = userAns === undefined;\r\n\r\n                        return (\r\n                            <div key={q.id} style={{\r\n                                background: 'white', padding: '1.5rem', borderRadius: '12px',\r\n                                border: '1px solid', borderColor: isCorrect ? '#e2e8f0' : '#fecaca',\r\n                                position: 'relative'\r\n                            }}>\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1rem' }}>\r\n                                    <span style={{ fontWeight: 700, fontSize: '1.1rem', color: isCorrect ? '#0f172a' : '#ef4444' }}>\r\n                                        ë¬¸í•­ {q.number}\r\n                                    </span>\r\n                                    <span style={{\r\n                                        fontWeight: 600, fontSize: '0.9rem',\r\n                                        color: isCorrect ? '#16a34a' : '#dc2626'\r\n                                    }}>\r\n                                        {isCorrect ? \"âœ… ì •ë‹µ\" : \"âŒ ì˜¤ë‹µ\"}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <div style={{ display: 'flex', gap: '2rem', fontSize: '0.95rem' }}>\r\n                                    <div>\r\n                                        <span style={{ color: '#64748b', marginRight: '0.5rem' }}>ë‚´ê°€ ì“´ ë‹µ:</span>\r\n                                        <span style={{ fontWeight: 700, color: isCorrect ? '#0f172a' : '#ef4444' }}>\r\n                                            {isSkipped ? '(ë¯¸ì‘ë‹µ)' : userAns}\r\n                                        </span>\r\n                                    </div>\r\n                                    {!isCorrect && q.answer && (\r\n                                        <div>\r\n                                            <span style={{ color: '#64748b', marginRight: '0.5rem' }}>ì •ë‹µ:</span>\r\n                                            <span style={{ fontWeight: 700, color: '#16a34a' }}>{q.answer}</span>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {q.label && (\r\n                                    <div style={{ marginTop: '1rem', display: 'flex', gap: '0.5rem' }}>\r\n                                        <span style={{ fontSize: '0.75rem', padding: '2px 8px', borderRadius: '4px', background: '#f1f5f9', color: '#64748b' }}>\r\n                                            #{q.label}\r\n                                        </span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {filterWrong && filteredQuestions.length === 0 && (\r\n                    <div style={{ textAlign: 'center', padding: '3rem', color: '#64748b' }}>\r\n                        ğŸ‰ í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!\r\n                    </div>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":36,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":44,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\dashboard\\page.tsx:49:9\n  47 |         // Sort exams by date\n  48 |         loadedExams.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n> 49 |         setExams(loadedExams);\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |         setAttempts(loadedAttempts);\n  51 |\n  52 |         // Calculate Stats","line":49,"column":9,"nodeType":null,"endLine":49,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { Exam, Attempt } from \"@/types/omr\";\r\nimport OverviewTab from \"@/components/dashboard/tabs/OverviewTab\";\r\nimport ExamAnalyticsTab from \"@/components/dashboard/tabs/ExamAnalyticsTab\";\r\nimport StudentAnalyticsTab from \"@/components/dashboard/tabs/StudentAnalyticsTab\";\r\nimport { LayoutDashboard, BarChart2, GraduationCap } from \"lucide-react\";\r\n\r\ntype TabType = 'overview' | 'exam' | 'student';\r\n\r\nexport default function TeacherDashboard() {\r\n    const [activeTab, setActiveTab] = useState<TabType>('overview');\r\n    const [exams, setExams] = useState<Exam[]>([]);\r\n    const [attempts, setAttempts] = useState<Attempt[]>([]);\r\n    const [stats, setStats] = useState({\r\n        totalStudents: 0,\r\n        avgScore: 0,\r\n        activeExams: 0\r\n    });\r\n    const [trendData, setTrendData] = useState<number[]>([]);\r\n\r\n    useEffect(() => {\r\n        // Load Data\r\n        const loadedExams: Exam[] = [];\r\n        const loadedAttempts: Attempt[] = [];\r\n\r\n        // Scan localStorage for exams\r\n        for (let i = 0; i < localStorage.length; i++) {\r\n            const key = localStorage.key(i);\r\n            if (key?.startsWith(\"omr_exam_\")) {\r\n                try {\r\n                    const val = JSON.parse(localStorage.getItem(key) || \"\");\r\n                    loadedExams.push(val);\r\n                } catch (e) { }\r\n            }\r\n        }\r\n        // Load attempts\r\n        const attemptsStr = localStorage.getItem(\"omr_attempts\");\r\n        if (attemptsStr) {\r\n            try {\r\n                loadedAttempts.push(...JSON.parse(attemptsStr));\r\n            } catch (e) { }\r\n        }\r\n\r\n        // Sort exams by date\r\n        loadedExams.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        setExams(loadedExams);\r\n        setAttempts(loadedAttempts);\r\n\r\n        // Calculate Stats\r\n        const totalScore = loadedAttempts.reduce((acc, curr) => acc + (curr.score / curr.totalScore) * 100, 0);\r\n        const avg = loadedAttempts.length > 0 ? Math.round(totalScore / loadedAttempts.length) : 0;\r\n\r\n        setStats({\r\n            totalStudents: new Set(loadedAttempts.map(a => a.studentName + a.id)).size,\r\n            avgScore: avg,\r\n            activeExams: loadedExams.length\r\n        });\r\n\r\n        // Calculate Trend Data (Last N attempts scores)\r\n        const scores = loadedAttempts\r\n            .sort((a, b) => new Date(a.finishedAt).getTime() - new Date(b.finishedAt).getTime())\r\n            .map(a => Math.round((a.score / a.totalScore) * 100))\r\n            .slice(-10);\r\n\r\n        if (scores.length < 5) {\r\n            // Mock data with average if not enough\r\n            setTrendData([65, 78, 72, 85, 82, 90, avg || 80]);\r\n        } else {\r\n            setTrendData(scores);\r\n        }\r\n\r\n    }, []);\r\n\r\n    // Tab Navigation Component\r\n    const renderTabs = () => (\r\n        <div style={{\r\n            display: 'flex', gap: '0.5rem', marginBottom: '2rem',\r\n            background: 'var(--surface)', padding: '0.5rem', borderRadius: 'var(--radius-lg)',\r\n            border: '1px solid var(--border)', overflowX: 'auto',\r\n            boxShadow: '0 4px 6px rgba(0,0,0,0.02)'\r\n        }}>\r\n            <button\r\n                onClick={() => setActiveTab('overview')}\r\n                style={{\r\n                    display: 'flex', alignItems: 'center', gap: '0.5rem',\r\n                    padding: '0.75rem 1.5rem', borderRadius: 'var(--radius-md)',\r\n                    background: activeTab === 'overview' ? 'var(--primary)' : 'transparent',\r\n                    color: activeTab === 'overview' ? 'white' : 'var(--muted)',\r\n                    fontWeight: activeTab === 'overview' ? 700 : 500,\r\n                    transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)', flex: 1, justifyContent: 'center', whiteSpace: 'nowrap'\r\n                }}\r\n            >\r\n                <LayoutDashboard size={18} />\r\n                ëŒ€ì‹œë³´ë“œ ìš”ì•½\r\n            </button>\r\n            <button\r\n                onClick={() => setActiveTab('exam')}\r\n                style={{\r\n                    display: 'flex', alignItems: 'center', gap: '0.5rem',\r\n                    padding: '0.75rem 1.5rem', borderRadius: 'var(--radius-md)',\r\n                    background: activeTab === 'exam' ? 'var(--primary)' : 'transparent',\r\n                    color: activeTab === 'exam' ? 'white' : 'var(--muted)',\r\n                    fontWeight: activeTab === 'exam' ? 700 : 500,\r\n                    transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)', flex: 1, justifyContent: 'center', whiteSpace: 'nowrap'\r\n                }}\r\n            >\r\n                <BarChart2 size={18} />\r\n                ì‹œí—˜ ë¶„ì„\r\n            </button>\r\n            <button\r\n                onClick={() => setActiveTab('student')}\r\n                style={{\r\n                    display: 'flex', alignItems: 'center', gap: '0.5rem',\r\n                    padding: '0.75rem 1.5rem', borderRadius: 'var(--radius-md)',\r\n                    background: activeTab === 'student' ? 'var(--primary)' : 'transparent',\r\n                    color: activeTab === 'student' ? 'white' : 'var(--muted)',\r\n                    fontWeight: activeTab === 'student' ? 700 : 500,\r\n                    transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)', flex: 1, justifyContent: 'center', whiteSpace: 'nowrap'\r\n                }}\r\n            >\r\n                <GraduationCap size={18} />\r\n                í•™ìƒ ì„±ì·¨ë„\r\n            </button>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"layout-main\">\r\n            <header className=\"header\">\r\n                <div className=\"container header-content\">\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                        <Link href=\"/\" className=\"logo\">Classin</Link>\r\n                        <span style={{\r\n                            fontSize: '0.75rem', fontWeight: 700,\r\n                            background: 'rgba(99, 102, 241, 0.1)', color: 'var(--primary)',\r\n                            padding: '4px 10px', borderRadius: 'var(--radius-full)',\r\n                            border: '1px solid rgba(99, 102, 241, 0.2)'\r\n                        }}>\r\n                            TEACHER\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"container animate-fade-in\" style={{ paddingBottom: '4rem' }}>\r\n                {/* Welcome Section */}\r\n                <div style={{ margin: '3rem 0', display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end' }}>\r\n                    <div>\r\n                        <h1 className=\"title-gradient\" style={{ fontSize: '2.5rem', marginBottom: '0.75rem', lineHeight: 1.2 }}>\r\n                            Analytics Center\r\n                        </h1>\r\n                        <p className=\"text-muted\" style={{ fontSize: '1.1rem' }}>\r\n                            ë°©ëŒ€í•œ ë¦¬í¬íŠ¸ì™€ ì‹œí—˜ í†µê³„ë¥¼ í•œ ë²ˆì— ê´€ë¦¬í•˜ì„¸ìš”.\r\n                        </p>\r\n                    </div>\r\n                    {activeTab !== 'overview' && (\r\n                        <Link href=\"/create\" style={{\r\n                            padding: '0.75rem 1.5rem', background: 'var(--primary)',\r\n                            color: 'white', borderRadius: 'var(--radius-full)',\r\n                            fontWeight: 600, display: 'flex', alignItems: 'center', gap: '0.5rem',\r\n                            boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)'\r\n                        }}>\r\n                            ì‹œí—˜ ì¶œì œí•˜ê¸°\r\n                        </Link>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Tabs */}\r\n                {renderTabs()}\r\n\r\n                {/* Tab Content */}\r\n                <div style={{ minHeight: '600px' }}>\r\n                    {activeTab === 'overview' && (\r\n                        <OverviewTab exams={exams} attempts={attempts} stats={stats} trendData={trendData} />\r\n                    )}\r\n                    {activeTab === 'exam' && (\r\n                        <ExamAnalyticsTab exams={exams} attempts={attempts} />\r\n                    )}\r\n                    {activeTab === 'student' && (\r\n                        <StudentAnalyticsTab exams={exams} attempts={attempts} />\r\n                    )}\r\n                </div>\r\n\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\exam\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\app\\teacher\\exam\\[id]\\page.tsx:28:13\n  26 |         const examData = localStorage.getItem(`omr_exam_${id}`);\n  27 |         if (examData) {\n> 28 |             setExam(JSON.parse(examData));\n     |             ^^^^^^^ Avoid calling setState() directly within an effect\n  29 |         }\n  30 |\n  31 |         // Load Attempts for this exam","line":28,"column":13,"nodeType":null,"endLine":28,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { Exam, Attempt } from \"@/types/omr\";\r\nimport StatCard from \"@/components/dashboard/StatCard\";\r\n\r\nexport default function ExamDetailPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const id = params?.id as string;\r\n\r\n    const [exam, setExam] = useState<Exam | null>(null);\r\n    const [attempts, setAttempts] = useState<Attempt[]>([]);\r\n    const [stats, setStats] = useState({\r\n        avgScore: 0,\r\n        maxScore: 0,\r\n        submitCount: 0\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (!id) return;\r\n\r\n        // Load Exam\r\n        const examData = localStorage.getItem(`omr_exam_${id}`);\r\n        if (examData) {\r\n            setExam(JSON.parse(examData));\r\n        }\r\n\r\n        // Load Attempts for this exam\r\n        const allAttemptsStr = localStorage.getItem(\"omr_attempts\");\r\n        if (allAttemptsStr) {\r\n            const allAttempts: Attempt[] = JSON.parse(allAttemptsStr);\r\n            const examAttempts = allAttempts.filter(a => a.examId === id);\r\n            setAttempts(examAttempts);\r\n\r\n            // Calculate Stats\r\n            if (examAttempts.length > 0) {\r\n                const total = examAttempts.reduce((acc, curr) => acc + curr.score, 0);\r\n                const max = Math.max(...examAttempts.map(a => a.score));\r\n\r\n                // Assuming all attempts have same totalScore (from the exam)\r\n                // If not, we should use percentage. Let's use raw score here.\r\n                setStats({\r\n                    avgScore: parseFloat((total / examAttempts.length).toFixed(1)),\r\n                    maxScore: max,\r\n                    submitCount: examAttempts.length\r\n                });\r\n            }\r\n        }\r\n    }, [id]);\r\n\r\n    if (!exam) return <div style={{ padding: '2rem' }}>Loading...</div>;\r\n\r\n    return (\r\n        <div className=\"layout-main\" style={{ background: '#f8fafc', minHeight: '100vh' }}>\r\n            <header className=\"header\" style={{ borderBottom: '1px solid var(--border)' }}>\r\n                <div className=\"container header-content\">\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                        <button onClick={() => router.back()} style={{ fontSize: '1.2rem' }}>â†</button>\r\n                        <span style={{ fontWeight: 700 }}>{exam.title}</span>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"container animate-fade-in\" style={{ padding: '2rem 1rem' }}>\r\n\r\n                {/* Stats Row */}\r\n                <div className=\"bento-grid\" style={{ marginBottom: '2rem', gridTemplateColumns: 'repeat(3, 1fr)', gridAutoRows: 'auto' }}>\r\n                    <StatCard title=\"Submissions\" value={stats.submitCount} icon={<span>ğŸ“</span>} />\r\n                    <StatCard title=\"Average Score\" value={stats.avgScore} icon={<span>ğŸ“Š</span>} color=\"var(--primary)\" />\r\n                    <StatCard title=\"Highest Score\" value={stats.maxScore} icon={<span>ğŸ†</span>} color=\"var(--warning)\" />\r\n                </div>\r\n\r\n                {/* Students Table */}\r\n                <div className=\"bento-card\" style={{ padding: '0', overflow: 'hidden' }}>\r\n                    <div style={{ padding: '1.5rem', borderBottom: '1px solid var(--border)' }}>\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 700 }}>Student Results</h3>\r\n                    </div>\r\n\r\n                    <div style={{ overflowX: 'auto' }}>\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '0.9rem' }}>\r\n                            <thead style={{ background: '#f8fafc', borderBottom: '1px solid var(--border)' }}>\r\n                                <tr>\r\n                                    <th style={{ padding: '1rem', textAlign: 'left', color: 'var(--muted)' }}>Student</th>\r\n                                    <th style={{ padding: '1rem', textAlign: 'left', color: 'var(--muted)' }}>Score</th>\r\n                                    <th style={{ padding: '1rem', textAlign: 'left', color: 'var(--muted)' }}>Time</th>\r\n                                    <th style={{ padding: '1rem', textAlign: 'left', color: 'var(--muted)' }}>Status</th>\r\n                                    <th style={{ padding: '1rem', textAlign: 'right', color: 'var(--muted)' }}>Action</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {attempts.length === 0 ? (\r\n                                    <tr>\r\n                                        <td colSpan={5} style={{ padding: '3rem', textAlign: 'center', color: 'var(--muted)' }}>\r\n                                            No submissions yet.\r\n                                        </td>\r\n                                    </tr>\r\n                                ) : (\r\n                                    attempts.map(attempt => (\r\n                                        <tr key={attempt.id} style={{ borderBottom: '1px solid var(--border)' }}>\r\n                                            <td style={{ padding: '1rem', fontWeight: 600 }}>{attempt.studentName || 'Anonymous'}</td>\r\n                                            <td style={{ padding: '1rem' }}>\r\n                                                <span style={{ fontWeight: 700, color: 'var(--foreground)' }}>{attempt.score}</span>\r\n                                                <span style={{ color: 'var(--muted)', fontSize: '0.8rem' }}> / {attempt.totalScore}</span>\r\n                                            </td>\r\n                                            <td style={{ padding: '1rem', color: 'var(--muted)' }}>\r\n                                                {new Date(attempt.finishedAt).toLocaleString()}\r\n                                            </td>\r\n                                            <td style={{ padding: '1rem' }}>\r\n                                                <span style={{\r\n                                                    padding: '2px 8px', borderRadius: '4px', fontSize: '0.8rem', fontWeight: 600,\r\n                                                    background: '#dcfce7', color: '#166534'\r\n                                                }}>\r\n                                                    Completed\r\n                                                </span>\r\n                                            </td>\r\n                                            <td style={{ padding: '1rem', textAlign: 'right' }}>\r\n                                                <Link\r\n                                                    href={`/student/review/${attempt.id}`}\r\n                                                    className=\"btn btn-secondary\"\r\n                                                    style={{ padding: '0.3rem 0.8rem', fontSize: '0.8rem' }}\r\n                                                >\r\n                                                    View OMR\r\n                                                </Link>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\AnswerImportModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'file'. Either include it or remove the dependency array.","line":25,"column":8,"nodeType":"ArrayExpression","endLine":25,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [file, useAI]","fix":{"range":[974,981],"text":"[file, useAI]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1763,1766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1763,1766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { parseAnswerKeyPdf, ParsedAnswer } from '@/services/answerParser';\r\n\r\ninterface AnswerImportModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onApply: (answers: Record<number, number>) => void;\r\n    onUploadAnswerPdf?: (file: File) => void; // For reference-only PDF (teacher view only)\r\n}\r\n\r\nexport default function AnswerImportModal({ isOpen, onClose, onApply, onUploadAnswerPdf }: AnswerImportModalProps) {\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [parsedData, setParsedData] = useState<ParsedAnswer[]>([]);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [useAI, setUseAI] = useState(false);\r\n\r\n    // Use effect to re-analyze when AI mode is toggled if file exists\r\n    useEffect(() => {\r\n        if (file) {\r\n            analyzeFile(file, useAI);\r\n        }\r\n    }, [useAI]);\r\n\r\n    const analyzeFile = async (targetFile: File, isAiMode: boolean) => {\r\n        setIsProcessing(true);\r\n        setError(null);\r\n        setParsedData([]);\r\n\r\n        try {\r\n            let results;\r\n            if (isAiMode) {\r\n                const { parseAnswerKeyWithGemini } = await import('@/services/answerParser');\r\n                results = await parseAnswerKeyWithGemini(targetFile);\r\n            } else {\r\n                results = await parseAnswerKeyPdf(targetFile);\r\n            }\r\n\r\n            if (results.length === 0) {\r\n                setError(isAiMode\r\n                    ? \"AIê°€ ì •ë‹µì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ê°€ ì„ ëª…í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\"\r\n                    : \"í…ìŠ¤íŠ¸ ì •ë‹µì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 'AI ì¸ì‹' ëª¨ë“œë¥¼ ì‚¬ìš©ë³´ì„¸ìš”.\");\r\n            }\r\n            setParsedData(results);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            if (err.message && err.message.includes(\"GEMINI_API_KEY\")) {\r\n                setError(\"ì„œë²„ì— GEMINI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\");\r\n            } else {\r\n                setError(\"ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. \" + (isAiMode ? \"(AI ëª¨ë“œëŠ” ì‹œê°„ì´ ë” ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)\" : \"\"));\r\n            }\r\n        } finally {\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files && e.target.files[0]) {\r\n            const selectedFile = e.target.files[0];\r\n            setFile(selectedFile);\r\n            analyzeFile(selectedFile, useAI);\r\n        }\r\n    };\r\n\r\n    const handleAnswerChange = (idx: number, newVal: string) => {\r\n        const numVal = parseInt(newVal, 10);\r\n        setParsedData(prev => {\r\n            const next = [...prev];\r\n            next[idx] = { ...next[idx], answer: numVal };\r\n            return next;\r\n        });\r\n    };\r\n\r\n    const handleApply = () => {\r\n        const mapping: Record<number, number> = {};\r\n        parsedData.forEach(item => {\r\n            mapping[item.questionNum] = item.answer;\r\n        });\r\n        onApply(mapping);\r\n        onClose();\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', inset: 0,\r\n            background: 'rgba(0,0,0,0.5)',\r\n            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n            zIndex: 1000\r\n        }}>\r\n            <div style={{\r\n                background: 'white',\r\n                width: '600px',\r\n                maxHeight: '80vh',\r\n                borderRadius: '8px',\r\n                display: 'flex', flexDirection: 'column',\r\n                boxShadow: '0 4px 6px rgba(0,0,0,0.1)'\r\n            }}>\r\n                <header style={{ padding: '1.5rem', borderBottom: '1px solid #eee', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <h2 style={{ fontSize: '1.25rem', fontWeight: 600 }}>ì •ë‹µ PDF ë¶ˆëŸ¬ì˜¤ê¸°</h2>\r\n                    <button onClick={onClose} style={{ border: 'none', background: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>&times;</button>\r\n                </header>\r\n\r\n                <div style={{ padding: '1.5rem', overflowY: 'auto', flex: 1 }}>\r\n                    <div style={{ marginBottom: '1.5rem', textAlign: 'center', padding: '2rem', border: '2px dashed #ddd', borderRadius: '8px' }}>\r\n                        <input type=\"file\" accept=\".pdf\" onChange={handleFileChange} style={{ display: 'none' }} id=\"answer-pdf-upload\" />\r\n                        <label htmlFor=\"answer-pdf-upload\" className=\"btn btn-primary\" style={{ cursor: 'pointer', display: 'inline-block' }}>\r\n                            {file ? \"PDF ë³€ê²½í•˜ê¸°\" : \"PDF ì—…ë¡œë“œí•˜ì—¬ ì •ë‹µ ì¶”ì¶œ\"}\r\n                        </label>\r\n                        {file && <p style={{ marginTop: '0.5rem', fontSize: '0.9rem', color: '#666' }}>{file.name}</p>}\r\n                    </div>\r\n\r\n                    <div style={{ marginBottom: '1.5rem', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            id=\"use-ai-mode\"\r\n                            checked={useAI}\r\n                            onChange={(e) => setUseAI(e.target.checked)}\r\n                            style={{ width: '1.2rem', height: '1.2rem' }}\r\n                        />\r\n                        <label htmlFor=\"use-ai-mode\" style={{ fontWeight: 500, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.3rem' }}>\r\n                            ğŸ¤– AI(Gemini)ë¡œ ì •ë‹µ ì¸ì‹í•˜ê¸° <span style={{ fontSize: '0.7rem', color: '#ef4444', border: '1px solid #ef4444', padding: '1px 4px', borderRadius: '4px' }}>ì¶”ì²œ</span>\r\n                        </label>\r\n                    </div>\r\n\r\n                    {isProcessing && <div style={{ textAlign: 'center', padding: '1rem' }}>ë¶„ì„ ì¤‘...</div>}\r\n\r\n                    {error && <div style={{ color: 'red', padding: '1rem', background: '#fff0f0', borderRadius: '4px' }}>{error}</div>}\r\n\r\n                    {parsedData.length > 0 && (\r\n                        <div>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1rem', alignItems: 'center' }}>\r\n                                <h3 style={{ fontWeight: 600 }}>ì¶”ì¶œ ê²°ê³¼ ({parsedData.length}ë¬¸í•­)</h3>\r\n                                <span style={{ fontSize: '0.8rem', color: '#666' }}>í•„ìš”ì‹œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”</span>\r\n                            </div>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(100px, 1fr))', gap: '0.5rem' }}>\r\n                                {parsedData.map((item, idx) => (\r\n                                    <div key={idx} style={{ padding: '0.5rem', border: '1px solid #eee', borderRadius: '4px', textAlign: 'center' }}>\r\n                                        <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '0.2rem' }}>ë¬¸í•­ {item.questionNum}</div>\r\n                                        <select\r\n                                            value={item.answer}\r\n                                            onChange={(e) => handleAnswerChange(idx, e.target.value)}\r\n                                            style={{ padding: '0.2rem', borderRadius: '4px', border: '1px solid #ccc', fontWeight: 'bold' }}\r\n                                        >\r\n                                            <option value={1}>â‘ </option>\r\n                                            <option value={2}>â‘¡</option>\r\n                                            <option value={3}>â‘¢</option>\r\n                                            <option value={4}>â‘£</option>\r\n                                            <option value={5}>â‘¤</option>\r\n                                        </select>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <footer style={{ padding: '1.5rem', borderTop: '1px solid #eee', display: 'flex', justifyContent: 'space-between', gap: '0.5rem' }}>\r\n                    <button\r\n                        onClick={() => {\r\n                            if (file && onUploadAnswerPdf) {\r\n                                onUploadAnswerPdf(file);\r\n                                onClose();\r\n                            }\r\n                        }}\r\n                        className=\"btn btn-secondary\"\r\n                        disabled={!file || !onUploadAnswerPdf}\r\n                        style={{ color: '#10b981', borderColor: '#10b981' }}\r\n                        title=\"ë¶„ì„ ì—†ì´ ì°¸ê³ ìš©ìœ¼ë¡œ ì—…ë¡œë“œ (í•™ìƒì—ê²ŒëŠ” ì œì¶œ í›„ ê³µê°œ)\"\r\n                    >\r\n                        ğŸ“ ì°¸ê³ ìš© ë‹µì§€ ì—…ë¡œë“œ\r\n                    </button>\r\n                    <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                        <button onClick={onClose} className=\"btn btn-secondary\">ì·¨ì†Œ</button>\r\n                        <button\r\n                            onClick={handleApply}\r\n                            className=\"btn btn-primary\"\r\n                            disabled={parsedData.length === 0}\r\n                        >\r\n                            ì ìš©í•˜ê¸°\r\n                        </button>\r\n                    </div>\r\n                </footer>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\DistributeModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[284,287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[284,287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'examTitle' is defined but never used.","line":14,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":69}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { QRCodeCanvas } from 'qrcode.react';\r\nimport { Group } from '@/types/omr';\r\n\r\ninterface DistributeModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    examTitle: string;\r\n    onSaveAndShare: (config: any) => Promise<string>; // Returns share URL\r\n}\r\n\r\nexport default function DistributeModal({ isOpen, onClose, examTitle, onSaveAndShare }: DistributeModalProps) {\r\n    const [accessType, setAccessType] = useState<'public' | 'group'>('public');\r\n    const [selectedGroups, setSelectedGroups] = useState<string[]>([]);\r\n    const [groups, setGroups] = useState<Group[]>([]);\r\n    const [shareUrl, setShareUrl] = useState<string | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            const storedGroups = localStorage.getItem('omr_groups');\r\n            if (storedGroups) {\r\n                setGroups(JSON.parse(storedGroups));\r\n            }\r\n            // Reset state\r\n            setShareUrl(null);\r\n            setAccessType('public');\r\n            setSelectedGroups([]);\r\n            setIsSaving(false);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleShareClick = async () => {\r\n        if (accessType === 'group' && selectedGroups.length === 0) {\r\n            alert(\"ê³µìœ í•  ê·¸ë£¹ì„ ìµœì†Œ í•˜ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”.\");\r\n            return;\r\n        }\r\n\r\n        const config = {\r\n            type: accessType,\r\n            groupIds: accessType === 'group' ? selectedGroups : undefined\r\n        };\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const url = await onSaveAndShare(config);\r\n            setShareUrl(url);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const downloadQR = () => {\r\n        const canvas = document.getElementById(\"qr-code-canvas\") as HTMLCanvasElement;\r\n        if (canvas) {\r\n            const pngUrl = canvas.toDataURL(\"image/png\");\r\n            const downloadLink = document.createElement(\"a\");\r\n            downloadLink.href = pngUrl;\r\n            downloadLink.download = \"exam_qr.png\";\r\n            document.body.appendChild(downloadLink);\r\n            downloadLink.click();\r\n            document.body.removeChild(downloadLink);\r\n        }\r\n    };\r\n\r\n    const toggleGroup = (id: string) => {\r\n        setSelectedGroups(prev =>\r\n            prev.includes(id) ? prev.filter(g => g !== id) : [...prev, id]\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed', inset: 0,\r\n            background: 'rgba(0,0,0,0.5)',\r\n            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n            zIndex: 1000\r\n        }}>\r\n            <div style={{\r\n                background: 'white',\r\n                width: '500px',\r\n                borderRadius: '8px',\r\n                display: 'flex', flexDirection: 'column',\r\n                boxShadow: '0 4px 6px rgba(0,0,0,0.1)'\r\n            }}>\r\n                <header style={{ padding: '1.5rem', borderBottom: '1px solid #eee', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <h2 style={{ fontSize: '1.25rem', fontWeight: 600 }}>ì‹œí—˜ ë°°í¬í•˜ê¸°</h2>\r\n                    <button onClick={onClose} style={{ border: 'none', background: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>&times;</button>\r\n                </header>\r\n\r\n                <div style={{ padding: '2rem' }}>\r\n                    {!shareUrl ? (\r\n                        <>\r\n                            <div style={{ marginBottom: '1.5rem' }}>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>ì ‘ê·¼ ê¶Œí•œ ì„¤ì •</label>\r\n                                <div style={{ display: 'flex', gap: '1rem' }}>\r\n                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer' }}>\r\n                                        <input type=\"radio\" name=\"access\" checked={accessType === 'public'} onChange={() => setAccessType('public')} />\r\n                                        ì „ì²´ ê³µê°œ (ë§í¬ ê³µìœ )\r\n                                    </label>\r\n                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer' }}>\r\n                                        <input type=\"radio\" name=\"access\" checked={accessType === 'group'} onChange={() => setAccessType('group')} />\r\n                                        íŠ¹ì • ê·¸ë£¹ë§Œ\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {accessType === 'group' && (\r\n                                <div style={{ marginBottom: '1.5rem', background: '#f8fafc', padding: '1rem', borderRadius: '8px' }}>\r\n                                    <p style={{ fontSize: '0.9rem', marginBottom: '0.5rem', color: '#666' }}>ì‘ì‹œí•  ê·¸ë£¹ ì„ íƒ:</p>\r\n                                    {groups.length === 0 ? (\r\n                                        <div style={{ color: 'red', fontSize: '0.9rem' }}>ìƒì„±ëœ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤. ê·¸ë£¹ ë©”ë‰´ì—ì„œ ë¨¼ì € ìƒì„±í•˜ì„¸ìš”.</div>\r\n                                    ) : (\r\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', maxHeight: '150px', overflowY: 'auto' }}>\r\n                                            {groups.map(g => (\r\n                                                <label key={g.id} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.9rem' }}>\r\n                                                    <input\r\n                                                        type=\"checkbox\"\r\n                                                        checked={selectedGroups.includes(g.id)}\r\n                                                        onChange={() => toggleGroup(g.id)}\r\n                                                    />\r\n                                                    {g.name}\r\n                                                </label>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n\r\n                            <button\r\n                                onClick={handleShareClick}\r\n                                className=\"btn btn-primary\"\r\n                                style={{ width: '100%', padding: '0.8rem' }}\r\n                                disabled={isSaving}\r\n                            >\r\n                                {isSaving ? \"ìƒì„± ì¤‘...\" : \"ë§í¬ ìƒì„±í•˜ê¸°\"}\r\n                            </button>\r\n                        </>\r\n                    ) : (\r\n                        <div style={{ textAlign: 'center' }}>\r\n                            <div style={{ marginBottom: '1.5rem' }}>\r\n                                <QRCodeCanvas id=\"qr-code-canvas\" value={shareUrl} size={200} level={\"H\"} includeMargin={true} />\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'center', marginBottom: '1.5rem' }}>\r\n                                <button onClick={downloadQR} className=\"btn btn-secondary\">QR ì €ì¥</button>\r\n                                <button onClick={() => { navigator.clipboard.writeText(shareUrl); alert(\"ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\"); }} className=\"btn btn-primary\">ë§í¬ ë³µì‚¬</button>\r\n                            </div>\r\n\r\n                            <div style={{ background: '#f1f5f9', padding: '0.5rem', borderRadius: '4px', fontSize: '0.8rem', wordBreak: 'break-all', color: '#666' }}>\r\n                                {shareUrl}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\OMRPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\PDFViewer.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\PDFViewer.tsx:52:13\n  50 |     useEffect(() => {\n  51 |         if (typeof forcePage === 'number' && forcePage >= 1 && forcePage <= numPages) {\n> 52 |             setPageNumber(forcePage);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  53 |         }\n  54 |     }, [forcePage, numPages]);\n  55 |","line":52,"column":13,"nodeType":null,"endLine":52,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":160,"column":13,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":160,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":279,"column":45,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":279,"endColumn":80}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { Document, Page, pdfjs } from 'react-pdf';\r\nimport 'react-pdf/dist/Page/AnnotationLayer.css';\r\nimport 'react-pdf/dist/Page/TextLayer.css';\r\n\r\n// Worker setup for Next.js\r\npdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;\r\n\r\ninterface PDFViewerProps {\r\n    file: File | null;\r\n    onLoadSuccess: (numPages: number) => void;\r\n    onPageClick?: (page: number, x: number, y: number) => void;\r\n    onFileDrop?: (file: File) => void;\r\n    // Drawing Props\r\n    enableDrawing?: boolean;\r\n    drawings?: Record<number, string[]>; // per page, array of path strings\r\n    onDrawingsChange?: (page: number, newPaths: string[]) => void;\r\n    // Markers Props\r\n    markers?: { page: number; x: number; y: number; label: string | number; color?: string; onClick?: () => void }[];\r\n}\r\n\r\nexport default function PDFViewer({\r\n    file,\r\n    onLoadSuccess,\r\n    onPageClick,\r\n    onFileDrop,\r\n    enableDrawing = false,\r\n    drawings = {},\r\n    onDrawingsChange,\r\n    markers = [],\r\n    forcePage\r\n}: PDFViewerProps & { forcePage?: number }) {\r\n    const [numPages, setNumPages] = useState<number>(0);\r\n    const [pageNumber, setPageNumber] = useState<number>(1);\r\n    const [scale, setScale] = useState<number>(1.0);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n\r\n    // Drawing State\r\n    const [isDrawing, setIsDrawing] = useState(false);\r\n    const [currentPath, setCurrentPath] = useState<{ x: number, y: number }[]>([]);\r\n    const [drawingMode, setDrawingMode] = useState<'pen' | 'eraser'>('pen');\r\n    const [penColor, setPenColor] = useState('#ef4444'); // Default Red\r\n\r\n    // Canvas Ref\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (typeof forcePage === 'number' && forcePage >= 1 && forcePage <= numPages) {\r\n            setPageNumber(forcePage);\r\n        }\r\n    }, [forcePage, numPages]);\r\n\r\n    function onDocumentLoadSuccess({ numPages }: { numPages: number }) {\r\n        setNumPages(numPages);\r\n        onLoadSuccess(numPages);\r\n    }\r\n\r\n    // --- Drawing Logic ---\r\n\r\n    // Render existing paths when page or drawings change\r\n    useEffect(() => {\r\n        if (!enableDrawing || !canvasRef.current || !containerRef.current) return;\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        // Resize canvas to match container (vital for scaling)\r\n        const rect = containerRef.current.getBoundingClientRect();\r\n        canvas.width = rect.width;\r\n        canvas.height = rect.height;\r\n\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n        // Draw saved paths\r\n        const paths = drawings[pageNumber] || [];\r\n        paths.forEach(pathStr => {\r\n            const pathData = JSON.parse(pathStr);\r\n            if (pathData.points && pathData.points.length > 0) {\r\n                ctx.beginPath();\r\n                ctx.strokeStyle = pathData.color;\r\n                ctx.lineWidth = 2;\r\n                ctx.moveTo(pathData.points[0].x * canvas.width, pathData.points[0].y * canvas.height);\r\n                for (let i = 1; i < pathData.points.length; i++) {\r\n                    ctx.lineTo(pathData.points[i].x * canvas.width, pathData.points[i].y * canvas.height);\r\n                }\r\n                ctx.stroke();\r\n            }\r\n        });\r\n\r\n    }, [pageNumber, drawings, enableDrawing, scale, file]); // Re-render on these changes\r\n\r\n    const startDrawing = (e: React.MouseEvent | React.TouchEvent) => {\r\n        if (!enableDrawing || drawingMode === 'eraser') return;\r\n        setIsDrawing(true);\r\n        const pos = getPos(e);\r\n        setCurrentPath([pos]);\r\n    };\r\n\r\n    const draw = (e: React.MouseEvent | React.TouchEvent) => {\r\n        if (!isDrawing || !enableDrawing || !canvasRef.current) return;\r\n        const pos = getPos(e);\r\n        setCurrentPath(prev => [...prev, pos]);\r\n\r\n        // Real-time visual feedback\r\n        const ctx = canvasRef.current.getContext('2d');\r\n        if (ctx) {\r\n            const rect = canvasRef.current.getBoundingClientRect();\r\n            ctx.lineTo(pos.x * rect.width, pos.y * rect.height);\r\n            ctx.stroke();\r\n            // Note: This is a hacky visual update, real render happens on useEffect usually.\r\n            // Better: draw single segment.\r\n            ctx.beginPath();\r\n            const last = currentPath[currentPath.length - 1];\r\n            if (last) ctx.moveTo(last.x * rect.width, last.y * rect.height);\r\n            ctx.lineTo(pos.x * rect.width, pos.y * rect.height);\r\n            ctx.strokeStyle = penColor;\r\n            ctx.lineWidth = 2;\r\n            ctx.stroke();\r\n        }\r\n    };\r\n\r\n    const stopDrawing = () => {\r\n        if (!isDrawing) return;\r\n        setIsDrawing(false);\r\n\r\n        // Save Path\r\n        if (currentPath.length > 1 && onDrawingsChange) {\r\n            const newPath = {\r\n                color: penColor,\r\n                points: currentPath\r\n            };\r\n            const currentPaths = drawings[pageNumber] || [];\r\n            onDrawingsChange(pageNumber, [...currentPaths, JSON.stringify(newPath)]);\r\n        }\r\n        setCurrentPath([]);\r\n    };\r\n\r\n    const getPos = (e: React.MouseEvent | React.TouchEvent) => {\r\n        if (!canvasRef.current) return { x: 0, y: 0 };\r\n        const rect = canvasRef.current.getBoundingClientRect();\r\n        let clientX, clientY;\r\n        if ('touches' in e) {\r\n            clientX = e.touches[0].clientX;\r\n            clientY = e.touches[0].clientY;\r\n        } else {\r\n            clientX = (e as React.MouseEvent).clientX;\r\n            clientY = (e as React.MouseEvent).clientY;\r\n        }\r\n        return {\r\n            x: (clientX - rect.left) / rect.width,\r\n            y: (clientY - rect.top) / rect.height\r\n        };\r\n    };\r\n\r\n    const clearPage = () => {\r\n        if (confirm(\"ì´ í˜ì´ì§€ì˜ í•„ê¸°ë¥¼ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?\")) {\r\n            onDrawingsChange && onDrawingsChange(pageNumber, []);\r\n        }\r\n    };\r\n\r\n    // --- End Drawing Logic ---\r\n\r\n\r\n    function handlePageClick(event: React.MouseEvent<HTMLDivElement>) {\r\n        // ... (Existing click logic, maybe disable if drawing?)\r\n        if (enableDrawing && drawingMode === 'pen') return; // Don't trigger link click while drawing\r\n        if (!onPageClick) return;\r\n\r\n        const rect = event.currentTarget.getBoundingClientRect();\r\n        const x = event.clientX - rect.left;\r\n        const y = event.clientY - rect.top;\r\n        const normalizedX = x / rect.width;\r\n        const normalizedY = y / rect.height;\r\n\r\n        onPageClick(pageNumber, normalizedX, normalizedY);\r\n    }\r\n\r\n    // Drag & Drop Handlers (Existing...)\r\n    const handleDragOver = (e: React.DragEvent) => { e.preventDefault(); setIsDragging(true); };\r\n    const handleDragLeave = (e: React.DragEvent) => { e.preventDefault(); setIsDragging(false); };\r\n    const handleDrop = (e: React.DragEvent) => {\r\n        e.preventDefault(); setIsDragging(false);\r\n        if (onFileDrop && e.dataTransfer.files[0] && e.dataTransfer.files[0].type === 'application/pdf') {\r\n            onFileDrop(e.dataTransfer.files[0]);\r\n        } else { alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className=\"pdf-viewer-container\"\r\n            onDragOver={handleDragOver} onDragLeave={handleDragLeave} onDrop={handleDrop}\r\n            style={{\r\n                height: '100%', display: 'flex', flexDirection: 'column',\r\n                background: '#525659', borderRight: '1px solid #333', position: 'relative', overflow: 'hidden'\r\n            }}\r\n        >\r\n            {/* ... Drag Overlay ... */}\r\n            {isDragging && (\r\n                <div style={{ position: 'absolute', inset: 0, zIndex: 50, background: 'rgba(99, 102, 241, 0.2)', border: '3px dashed #6366f1', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold', fontSize: '1.5rem', backdropFilter: 'blur(4px)' }}>PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</div>\r\n            )}\r\n\r\n            {/* PDF Toolbar */}\r\n            <div style={{ padding: '0.5rem 1rem', background: '#323639', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontSize: '0.9rem', borderBottom: '1px solid #000' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                    <span style={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', maxWidth: '200px' }}>{file ? file.name : 'PDF ì—†ìŒ'}</span>\r\n                </div>\r\n\r\n                {file && (\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                        {/* Drawing Tools */}\r\n                        {enableDrawing && (\r\n                            <div style={{ display: 'flex', gap: '5px', marginRight: '1rem', paddingRight: '1rem', borderRight: '1px solid #666' }}>\r\n                                <button onClick={() => setDrawingMode(drawingMode === 'pen' ? 'eraser' : 'pen')} style={{ background: drawingMode === 'pen' ? '#6366f1' : 'transparent', border: '1px solid #666', borderRadius: '4px', padding: '2px 6px', color: 'white' }}>\r\n                                    {drawingMode === 'pen' ? 'âœï¸ ê·¸ë¦¬ê¸°' : 'ğŸ‘† í´ë¦­ëª¨ë“œ'}\r\n                                </button>\r\n                                {drawingMode === 'pen' && (\r\n                                    <>\r\n                                        <input type=\"color\" value={penColor} onChange={(e) => setPenColor(e.target.value)} style={{ width: '24px', height: '24px', padding: 0, border: 'none', background: 'none' }} />\r\n                                        <button onClick={clearPage} style={{ fontSize: '0.8rem', padding: '2px 6px', background: '#ef4444', border: 'none', borderRadius: '4px', color: 'white' }}>ì‚­ì œ</button>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        <button onClick={() => setPageNumber(p => Math.max(1, p - 1))} disabled={pageNumber <= 1} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer' }}>â—€</button>\r\n                        <span>{pageNumber} / {numPages}</span>\r\n                        <button onClick={() => setPageNumber(p => Math.min(numPages, p + 1))} disabled={pageNumber >= numPages} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer' }}>â–¶</button>\r\n                        <div style={{ width: '1px', height: '15px', background: '#666', margin: '0 0.5rem' }}></div>\r\n                        <button onClick={() => setScale(s => Math.max(0.5, s - 0.1))} style={{ color: 'white', cursor: 'pointer' }}>-</button>\r\n                        <span>{Math.round(scale * 100)}%</span>\r\n                        <button onClick={() => setScale(s => Math.min(2.5, s + 0.1))} style={{ color: 'white', cursor: 'pointer' }}>+</button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* PDF Content */}\r\n            <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', alignItems: 'center', background: '#525659', position: 'relative' }}>\r\n                <div style={{ flex: 1, display: 'flex', justifyContent: 'center', padding: '2rem', width: '100%' }}>\r\n                    {file ? (\r\n                        <Document file={file} onLoadSuccess={onDocumentLoadSuccess} loading={<div style={{ color: 'white' }}>ë¬¸ì„œ ë¡œë”© ì¤‘...</div>}>\r\n                            <div\r\n                                ref={containerRef}\r\n                                onClick={handlePageClick}\r\n                                style={{ position: 'relative', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)' }}\r\n                            >\r\n                                <Page pageNumber={pageNumber} scale={scale} renderTextLayer={true} renderAnnotationLayer={true} />\r\n\r\n                                {/* Canvas Overlay */}\r\n                                {enableDrawing && (\r\n                                    <canvas\r\n                                        ref={canvasRef}\r\n                                        onMouseDown={startDrawing}\r\n                                        onMouseMove={draw}\r\n                                        onMouseUp={stopDrawing}\r\n                                        onMouseLeave={stopDrawing}\r\n                                        onTouchStart={startDrawing}\r\n                                        onTouchMove={draw}\r\n                                        onTouchEnd={stopDrawing}\r\n                                        style={{\r\n                                            position: 'absolute',\r\n                                            top: 0, left: 0,\r\n                                            width: '100%', height: '100%',\r\n                                            zIndex: 10,\r\n                                            cursor: drawingMode === 'pen' ? 'crosshair' : 'default',\r\n                                            pointerEvents: drawingMode === 'pen' ? 'auto' : 'none' // Allow click through if not drawing\r\n                                        }}\r\n                                    />\r\n                                )}\r\n\r\n                                {/* Markers Overlay */}\r\n                                {markers.filter(m => m.page === pageNumber).map((marker, i) => (\r\n                                    <div\r\n                                        key={i}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            marker.onClick && marker.onClick();\r\n                                        }}\r\n                                        style={{\r\n                                            position: 'absolute',\r\n                                            left: `${marker.x * 100}%`,\r\n                                            top: `${marker.y * 100}%`,\r\n                                            transform: 'translate(-50%, -50%)',\r\n                                            zIndex: 20,\r\n                                            cursor: 'pointer',\r\n                                            width: '24px', height: '24px',\r\n                                            background: marker.color || '#ef4444',\r\n                                            color: 'white',\r\n                                            borderRadius: '50%',\r\n                                            display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                            fontWeight: 'bold', fontSize: '0.75rem',\r\n                                            boxShadow: '0 2px 4px rgba(0,0,0,0.3)',\r\n                                            border: '2px solid white'\r\n                                        }}\r\n                                        title={`Question ${marker.label}`}\r\n                                    >\r\n                                        {marker.label}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </Document>\r\n                    ) : (\r\n                        <div onClick={() => document.getElementById('pdf-upload-input')?.click()} style={{ color: '#aaa', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', width: '100%', cursor: 'pointer', border: '2px dashed #666', margin: '1rem', borderRadius: '1rem' }}>\r\n                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>ğŸ“„</div>\r\n                            <p style={{ fontWeight: 600 }}>PDF ì—…ë¡œë“œ</p>\r\n                            <p style={{ fontSize: '0.8rem', opacity: 0.7 }}>í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Bottom Pagination Toolbar (Only visible if file exists) */}\r\n                {file && (\r\n                    <div style={{\r\n                        width: '100%',\r\n                        padding: '0.5rem',\r\n                        background: '#323639',\r\n                        color: 'white',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        gap: '1rem',\r\n                        borderTop: '1px solid #000',\r\n                        marginTop: 'auto'\r\n                    }}>\r\n                        <button onClick={() => setPageNumber(p => Math.max(1, p - 1))} disabled={pageNumber <= 1} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer', background: 'rgba(255,255,255,0.1)', borderRadius: '4px', border: 'none' }}>â—€ ì´ì „</button>\r\n                        <span>{pageNumber} / {numPages}</span>\r\n                        <button onClick={() => setPageNumber(p => Math.min(numPages, p + 1))} disabled={pageNumber >= numPages} style={{ color: 'white', padding: '0.2rem 0.5rem', cursor: 'pointer', background: 'rgba(255,255,255,0.1)', borderRadius: '4px', border: 'none' }}>ë‹¤ìŒ â–¶</button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\AssignmentBlock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\ExamListBlock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\StatCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\TrendChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\tabs\\ExamAnalyticsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\tabs\\OverviewTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\components\\dashboard\\tabs\\StudentAnalyticsTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'exams' is defined but never used.","line":16,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport { Exam, Attempt } from \"@/types/omr\";\r\nimport {\r\n    LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip,\r\n    ResponsiveContainer, Legend\r\n} from 'recharts';\r\nimport { TrendingUp } from \"lucide-react\";\r\n\r\ninterface StudentAnalyticsTabProps {\r\n    exams: Exam[];\r\n    attempts: Attempt[];\r\n}\r\n\r\nexport default function StudentAnalyticsTab({ exams, attempts }: StudentAnalyticsTabProps) {\r\n    // Extract unique students\r\n    const students = useMemo(() => {\r\n        const studentMap = new Map<string, string>();\r\n        attempts.forEach(a => {\r\n            if (!studentMap.has(a.studentName)) {\r\n                studentMap.set(a.studentName, a.studentName);\r\n            }\r\n        });\r\n        return Array.from(studentMap.values()).sort();\r\n    }, [attempts]);\r\n\r\n    const [selectedStudent, setSelectedStudent] = useState<string>(students.length > 0 ? students[0] : \"\");\r\n    const [excludedExamIds, setExcludedExamIds] = useState<Set<string>>(new Set());\r\n\r\n    const toggleExamExclusion = (examId: string) => {\r\n        const newSet = new Set(excludedExamIds);\r\n        if (newSet.has(examId)) {\r\n            newSet.delete(examId);\r\n        } else {\r\n            newSet.add(examId);\r\n        }\r\n        setExcludedExamIds(newSet);\r\n    };\r\n\r\n    const studentAttempts = useMemo(() => {\r\n        if (!selectedStudent) return [];\r\n        return attempts\r\n            .filter(a => a.studentName === selectedStudent)\r\n            .sort((a, b) => new Date(a.finishedAt).getTime() - new Date(b.finishedAt).getTime());\r\n    }, [attempts, selectedStudent]);\r\n\r\n    // Data for Chart\r\n    const trendData = useMemo(() => {\r\n        return studentAttempts\r\n            .filter(a => !excludedExamIds.has(a.examId))\r\n            .map(attempt => {\r\n                // Find all attempts for this exam to calculate average\r\n                const allAttemptsForExam = attempts.filter(a => a.examId === attempt.examId);\r\n                const avgScore = allAttemptsForExam.length > 0\r\n                    ? allAttemptsForExam.reduce((sum, a) => sum + (a.score / a.totalScore) * 100, 0) / allAttemptsForExam.length\r\n                    : 0;\r\n\r\n                return {\r\n                    date: new Date(attempt.finishedAt).toLocaleDateString(undefined, { month: 'short', day: 'numeric' }),\r\n                    examTitle: attempt.examTitle,\r\n                    examId: attempt.examId,\r\n                    studentScore: Math.round((attempt.score / attempt.totalScore) * 100),\r\n                    avgScore: Math.round(avgScore),\r\n                };\r\n            });\r\n    }, [studentAttempts, attempts, excludedExamIds]);\r\n\r\n    if (students.length === 0) {\r\n        return <div className=\"text-center p-8 text-muted\">ì•„ì§ ì‘ì‹œ ê¸°ë¡ì´ ìˆëŠ” í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>;\r\n    }\r\n\r\n    // fallback when a student is not active\r\n    if (!selectedStudent && students.length > 0) {\r\n        setSelectedStudent(students[0]);\r\n    }\r\n\r\n    return (\r\n        <div className=\"fade-in-up\" style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>\r\n            {/* Filter Section */}\r\n            <div className=\"card\" style={{ padding: '1.5rem', display: 'flex', alignItems: 'center', gap: '1rem', background: 'var(--surface)' }}>\r\n                <span style={{ fontWeight: 600, color: 'var(--text)' }}>ë¶„ì„í•  í•™ìƒ ì„ íƒ:</span>\r\n                <select\r\n                    value={selectedStudent}\r\n                    onChange={(e) => setSelectedStudent(e.target.value)}\r\n                    style={{\r\n                        padding: '0.75rem 1rem',\r\n                        borderRadius: 'var(--radius-md)',\r\n                        border: '1px solid var(--border)',\r\n                        background: 'var(--background)',\r\n                        color: 'var(--text)',\r\n                        flex: 1,\r\n                        maxWidth: '400px',\r\n                        outline: 'none',\r\n                        cursor: 'pointer'\r\n                    }}\r\n                >\r\n                    {students.map(name => (\r\n                        <option key={name} value={name}>{name}</option>\r\n                    ))}\r\n                </select>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'minmax(0, 5fr) minmax(0, 3fr)', gap: '1.5rem' }}>\r\n                {/* Left side: Chart */}\r\n                <div className=\"card\" style={{ padding: '1.5rem', display: 'flex', flexDirection: 'column' }}>\r\n                    <div style={{ marginBottom: '1.5rem' }}>\r\n                        <h3 style={{ fontSize: '1.25rem', fontWeight: 700, display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>\r\n                            <TrendingUp size={20} color=\"var(--primary)\" />\r\n                            {selectedStudent} í•™ìƒ ì„±ì·¨ë„ ì¶”ì´\r\n                        </h3>\r\n                        <p style={{ color: 'var(--muted)', fontSize: '0.9rem' }}>\r\n                            ì‘ì‹œí•œ ì‹œí—˜ë“¤ì˜ ì ìˆ˜ ì¶”ì´ ë° ì „ì²´ í•™ìƒì˜ ì‹œí—˜ í‰ê· ì„ ê°™ì´ ë¹„êµí•©ë‹ˆë‹¤.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, minHeight: '350px', width: '100%' }}>\r\n                        {trendData.length > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <LineChart data={trendData} margin={{ top: 20, right: 30, left: 0, bottom: 20 }}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"var(--border)\" />\r\n                                    <XAxis dataKey=\"examTitle\" tick={{ fill: 'var(--muted)', fontSize: 12 }} axisLine={false} tickLine={false} />\r\n                                    <YAxis domain={[0, 100]} tick={{ fill: 'var(--muted)' }} axisLine={false} tickLine={false} />\r\n                                    <RechartsTooltip\r\n                                        contentStyle={{ borderRadius: '8px', border: '1px solid var(--border)', boxShadow: '0 4px 12px rgba(0,0,0,0.05)', background: 'var(--background)' }}\r\n                                        labelStyle={{ fontWeight: 'bold', color: 'var(--text)', marginBottom: '8px' }}\r\n                                    />\r\n                                    <Legend wrapperStyle={{ paddingTop: '20px' }} />\r\n                                    <Line\r\n                                        name=\"ë‚´ ì ìˆ˜\"\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"studentScore\"\r\n                                        stroke=\"var(--primary)\"\r\n                                        strokeWidth={3}\r\n                                        dot={{ r: 5, strokeWidth: 2, fill: 'var(--background)' }}\r\n                                        activeDot={{ r: 7 }}\r\n                                        animationDuration={1500}\r\n                                    />\r\n                                    <Line\r\n                                        name=\"ì´ë²ˆ ì‹œí—˜ ì „ì²´ í‰ê· \"\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"avgScore\"\r\n                                        stroke=\"var(--warning)\"\r\n                                        strokeWidth={2}\r\n                                        strokeDasharray=\"5 5\"\r\n                                        dot={{ r: 4, strokeWidth: 0, fill: 'var(--muted)' }}\r\n                                        animationDuration={1500}\r\n                                    />\r\n                                </LineChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div style={{ height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--muted)' }}>\r\n                                í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (ëª¨ë“  ì‹œí—˜ ëª©ë¡ì´ ì œì™¸ë¨)\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right side: Exam List & Inclusion Toggles */}\r\n                <div className=\"card\" style={{ padding: '1.5rem', display: 'flex', flexDirection: 'column' }}>\r\n                    <h3 style={{ fontSize: '1.1rem', fontWeight: 700, marginBottom: '0.5rem' }}>ì‘ì‹œ ê¸°ë¡ ({studentAttempts.length})</h3>\r\n                    <p style={{ fontSize: '0.85rem', color: 'var(--muted)', marginBottom: '1.5rem' }}>ì°¨íŠ¸ì—ì„œ ì œì™¸í•  ì‹œí—˜ì˜ ì²´í¬ë¥¼ í•´ì œí•˜ì„¸ìš”.</p>\r\n\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', overflowY: 'auto', flex: 1, maxHeight: '350px' }}>\r\n                        {studentAttempts.map(attempt => {\r\n                            const isExcluded = excludedExamIds.has(attempt.examId);\r\n                            const scoreRate = Math.round((attempt.score / attempt.totalScore) * 100);\r\n\r\n                            return (\r\n                                <label\r\n                                    key={attempt.id}\r\n                                    style={{\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        gap: '0.75rem',\r\n                                        padding: '0.75rem',\r\n                                        borderRadius: 'var(--radius-md)',\r\n                                        background: isExcluded ? 'transparent' : 'var(--surface)',\r\n                                        border: `1px solid ${isExcluded ? 'var(--border)' : 'var(--primary)'}`,\r\n                                        opacity: isExcluded ? 0.6 : 1,\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.2s'\r\n                                    }}\r\n                                    className=\"card-hover\"\r\n                                >\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={!isExcluded}\r\n                                        onChange={() => toggleExamExclusion(attempt.examId)}\r\n                                        style={{ accentColor: 'var(--primary)', width: '16px', height: '16px', cursor: 'pointer' }}\r\n                                    />\r\n                                    <div style={{ flex: 1, overflow: 'hidden' }}>\r\n                                        <div style={{ fontWeight: 600, fontSize: '0.9rem', whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}>{attempt.examTitle}</div>\r\n                                        <div style={{ fontSize: '0.75rem', color: 'var(--muted)' }}>{new Date(attempt.finishedAt).toLocaleDateString()}</div>\r\n                                    </div>\r\n                                    <div style={{ fontWeight: 800, fontSize: '1.1rem', color: scoreRate >= 80 ? 'var(--success)' : (scoreRate < 50 ? 'var(--error)' : 'var(--text)') }}>\r\n                                        {scoreRate}ì \r\n                                    </div>\r\n                                </label>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\services\\answerParser.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4795,4798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4795,4798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5243,5246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5243,5246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5491,5494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5491,5494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5571,5574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5571,5574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5579,5582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5579,5582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Answer parsing utility using PDF text extraction and Gemini AI for OCR\r\nimport { analyzeAnswerImages } from '@/app/actions/analyzeKey';\r\n\r\nexport interface ParsedAnswer {\r\n    questionNum: number;\r\n    answer: number; // 1=A, 2=B...\r\n    confidence: number; // 0-1\r\n    rawText: string;\r\n}\r\n\r\nasync function getPdfJs() {\r\n    const pdfjsLib = await import('pdfjs-dist');\r\n    // Ensure worker is set up\r\n    if (typeof window !== 'undefined' && !pdfjsLib.GlobalWorkerOptions.workerSrc) {\r\n        pdfjsLib.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjsLib.version}/build/pdf.worker.min.mjs`;\r\n    }\r\n    return pdfjsLib;\r\n}\r\n\r\nexport async function parseAnswerKeyPdf(file: File): Promise<ParsedAnswer[]> {\r\n    const pdfjsLib = await getPdfJs();\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\r\n\r\n    let allText = '';\r\n\r\n    // Extract text from all pages\r\n    for (let i = 1; i <= pdf.numPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n\r\n        // Sort items by Y (descending) then X (ascending) to approximate reading order\r\n        // Note: PDF coordinates: (0,0) is bottom-left usually.\r\n        // item.transform[5] is Y, item.transform[4] is X\r\n        const items = textContent.items.map((item: any) => ({\r\n            str: item.str,\r\n            x: item.transform[4],\r\n            y: item.transform[5]\r\n        }));\r\n\r\n        // Simple sort: Top to bottom, left to right\r\n        items.sort((a, b) => {\r\n            if (Math.abs(a.y - b.y) > 5) { // Threshold for same line\r\n                return b.y - a.y; // Higher Y first\r\n            }\r\n            return a.x - b.x;\r\n        });\r\n\r\n        const pageText = items.map(item => item.str).join(' ');\r\n        allText += ` ${pageText}`;\r\n    }\r\n\r\n    return extractAnswersFromText(allText);\r\n}\r\n\r\nfunction extractAnswersFromText(text: string): ParsedAnswer[] {\r\n    const results: ParsedAnswer[] = [];\r\n    const mapAnswerToNum = (ans: string): number => {\r\n        ans = ans.toUpperCase().trim();\r\n        const map: Record<string, number> = { 'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'â‘ ': 1, 'â‘¡': 2, 'â‘¢': 3, 'â‘£': 4, 'â‘¤': 5 };\r\n        return map[ans] || 0;\r\n    };\r\n\r\n    // Strategy 1: \"1. A\", \"2) B\", \"3-C\" patterns\r\n    // Regex explanation:\r\n    // (\\d+) : Question number\r\n    // \\s*[\\.\\)\\-]?\\s* : Separator (dot, parenthesis, hyphen, or just space)\r\n    // ([A-Eâ‘ -â‘¤]) : Answer (A-E or circled numbers)\r\n    const regex1 = /(\\d+)\\s*[\\.\\)\\-]\\s*([A-Eâ‘ -â‘¤])/gi;\r\n\r\n    let match;\r\n    while ((match = regex1.exec(text)) !== null) {\r\n        const qNum = parseInt(match[1], 10);\r\n        const ansStr = match[2];\r\n        const ansNum = mapAnswerToNum(ansStr);\r\n\r\n        if (qNum > 0 && ansNum > 0) {\r\n            // Check if duplicate, keep the one with higher confidence (or just overwrite)\r\n            // Here we assume sequential parsing is mostly correct\r\n            results.push({\r\n                questionNum: qNum,\r\n                answer: ansNum,\r\n                confidence: 0.9,\r\n                rawText: match[0]\r\n            });\r\n        }\r\n    }\r\n\r\n    // Strategy 2: Table format \"1 A\", \"2 B\" (if Strategy 1 failed for many)\r\n    if (results.length < 5) {\r\n        const regex2 = /(\\d+)\\s+([A-E])/gi;\r\n        while ((match = regex2.exec(text)) !== null) {\r\n            const qNum = parseInt(match[1], 10);\r\n            const ansNum = mapAnswerToNum(match[2]);\r\n            // Avoid duplicates\r\n            if (!results.find(r => r.questionNum === qNum)) {\r\n                results.push({\r\n                    questionNum: qNum,\r\n                    answer: ansNum,\r\n                    confidence: 0.7, // Lower confidence for just space separation\r\n                    rawText: match[0]\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return results.sort((a, b) => a.questionNum - b.questionNum);\r\n}\r\n\r\nexport async function parseAnswerKeyWithGemini(file: File): Promise<ParsedAnswer[]> {\r\n    const pdfjsLib = await getPdfJs();\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;\r\n\r\n    const maxPages = Math.min(pdf.numPages, 3); // Limit to 3 pages\r\n    const images: string[] = [];\r\n\r\n    for (let i = 1; i <= maxPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const viewport = page.getViewport({ scale: 2.0 }); // Higher scale for better OCR\r\n\r\n        const canvas = document.createElement('canvas');\r\n        const context = canvas.getContext('2d');\r\n        canvas.height = viewport.height;\r\n        canvas.width = viewport.width;\r\n\r\n        if (context) {\r\n            await page.render({ canvasContext: context, viewport } as any).promise;\r\n            // Use JPEG instead of PNG to save bandwidth and stay under limits\r\n            images.push(canvas.toDataURL('image/jpeg', 0.8));\r\n        }\r\n    }\r\n\r\n    try {\r\n        const aiResults = await analyzeAnswerImages(images);\r\n\r\n        if (!Array.isArray(aiResults)) {\r\n            throw new Error(\"AI response is not an array\");\r\n        }\r\n\r\n        // Convert to ParsedAnswer format\r\n        return aiResults.map((item: any) => ({\r\n            questionNum: parseInt(item.questionNum || item.id || item.number),\r\n            answer: parseInt(item.answer || item.val),\r\n            confidence: 0.95,\r\n            rawText: JSON.stringify(item)\r\n        })).filter((item: any) => !isNaN(item.questionNum) && !isNaN(item.answer))\r\n            .sort((a: any, b: any) => a.questionNum - b.questionNum);\r\n    } catch (e) {\r\n        console.error(\"AI Parsing failed:\", e);\r\n        throw e;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\types\\omr.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aaaha\\OneDrive\\ë°”íƒ• í™”ë©´\\Projects\\Class_project\\OMR_maker\\src\\utils\\storage.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1782,1785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1782,1785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const STORAGE_KEYS = {\r\n    EXAMS: \"omr_exams\", // Prefix for individual exams? No, current logic scans omr_exam_ prefix.\r\n    ATTEMPTS: \"omr_attempts\",\r\n    STUDENT_SESSION: \"omr_student_session\",\r\n    GUEST_ID: \"omr_guest_id\"\r\n};\r\n\r\nexport interface StudentSession {\r\n    name: string;\r\n    groupId?: string; // Optional for guest\r\n    groupName?: string;\r\n    isGuest: boolean;\r\n    guestId?: string; // specific UUID for guest\r\n}\r\n\r\n// Helper to generate UUID-like string\r\nexport function generateId(): string {\r\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\r\n}\r\n\r\nexport function getOrCreateGuestId(): string {\r\n    if (typeof window === 'undefined') return \"\";\r\n    let id = localStorage.getItem(STORAGE_KEYS.GUEST_ID);\r\n    if (!id) {\r\n        id = generateId();\r\n        localStorage.setItem(STORAGE_KEYS.GUEST_ID, id);\r\n    }\r\n    return id;\r\n}\r\n\r\nexport function saveSession(session: StudentSession) {\r\n    if (typeof window === 'undefined') return;\r\n    sessionStorage.setItem(STORAGE_KEYS.STUDENT_SESSION, JSON.stringify(session));\r\n}\r\n\r\nexport function getSession(): StudentSession | null {\r\n    if (typeof window === 'undefined') return null;\r\n    const str = sessionStorage.getItem(STORAGE_KEYS.STUDENT_SESSION);\r\n    return str ? JSON.parse(str) : null;\r\n}\r\n\r\nexport function clearSession() {\r\n    if (typeof window === 'undefined') return;\r\n    sessionStorage.removeItem(STORAGE_KEYS.STUDENT_SESSION);\r\n}\r\n\r\n// Data Merging Logic\r\nexport function mergeGuestAttempts(guestId: string, realStudentName: string) {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const attemptsStr = localStorage.getItem(STORAGE_KEYS.ATTEMPTS);\r\n    if (!attemptsStr) return;\r\n\r\n    try {\r\n        const allAttempts: any[] = JSON.parse(attemptsStr);\r\n        let updated = false;\r\n\r\n        const newAttempts = allAttempts.map(attempt => {\r\n            // Include attempts that match the guestId OR strictly anonymous attempts from this device (if we want to be aggressive)\r\n            // For now, let's assume we saved guestId in the attempt.\r\n            if (attempt.guestId === guestId && attempt.studentName !== realStudentName) {\r\n                updated = true;\r\n                return {\r\n                    ...attempt,\r\n                    studentName: realStudentName,\r\n                    // keep guestId for record or clear it? Keeping it is safer for now.\r\n                };\r\n            }\r\n            return attempt;\r\n        });\r\n\r\n        if (updated) {\r\n            localStorage.setItem(STORAGE_KEYS.ATTEMPTS, JSON.stringify(newAttempts));\r\n        }\r\n    } catch (e) {\r\n        console.error(\"Failed to merge attempts\", e);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]}]
